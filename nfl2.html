<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="NFL Slots 2">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#013369">
  <title>NFL Slots 2 - Complete Team Collection</title>
  <style>
    :root {
      /* NFL Theme Colors */
      --nfl-blue: #013369;
      --nfl-red: #D50A0A;
      --nfl-silver: #A5ACAF;
      --nfl-gold: #FFB612;
      --primary-bg: linear-gradient(135deg, #000000 0%, #1a1a2e 50%, #16213e 100%);
      --secondary-bg: #111827;
      --machine-body: linear-gradient(145deg, #2d3748, #1a202c);
      --machine-face: #000000;
      --chrome: #4a5568;
      --gold: #FFB612;
      --red-led: #DC2626;
      --green-led: #10B981;
      --blue-led: #3B82F6;
      --border-color: #374151;
      --text-color: #FFFFFF;
      --highlight-color: #FFB612;
      --win-color: #10B981;
      --jackpot-color: #FFB612;
      --symbol-size: 80px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Arial Black', Arial, sans-serif;
      background: var(--primary-bg);
      color: var(--text-color);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 10px;
      overflow-x: hidden;
    }

    .game-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      max-width: 800px;
      min-height: 100vh;
      justify-content: center;
    }

    .slot-machine {
      background: var(--machine-body);
      border: 8px solid var(--chrome);
      border-radius: 25px;
      padding: 20px;
      box-shadow: 
        0 0 50px rgba(255, 182, 18, 0.3),
        inset 0 0 20px rgba(255, 255, 255, 0.1);
      position: relative;
      width: 100%;
      max-width: 700px;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .machine-header {
      text-align: center;
      margin-bottom: 15px;
      position: relative;
    }

    .nfl-logo {
      width: 80px;
      height: auto;
      margin-bottom: 5px;
      filter: drop-shadow(0 0 10px var(--nfl-gold));
    }

    .machine-title {
      font-size: 1.8rem;
      font-weight: 900;
      color: var(--nfl-gold);
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
      letter-spacing: 2px;
      margin-bottom: 5px;
    }

    .subtitle {
      font-size: 0.9rem;
      color: var(--nfl-silver);
      font-weight: normal;
    }
    }

    .led-lights {
      position: absolute;
      top: -25px;
      left: 0;
      right: 0;
      display: flex;
      justify-content: space-around;
      z-index: 10;
    }

    .led-light {
      width: 25px;
      height: 25px;
      border-radius: 50%;
      background: var(--red-led);
      box-shadow: 
        inset 0 0 10px rgba(0, 0, 0, 0.5),
        0 0 10px rgba(220, 38, 38, 0.5);
      animation: ledPulse 2s infinite;
    }

    .led-light:nth-child(2) { background: var(--green-led); animation-delay: 0.5s; }
    .led-light:nth-child(3) { background: var(--blue-led); animation-delay: 1s; }
    .led-light:nth-child(4) { background: var(--nfl-gold); animation-delay: 1.5s; }

    @keyframes ledPulse {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 1; }
    }

    .reels-container {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 15px;
      background: var(--machine-face);
      border: 4px solid var(--chrome);
      border-radius: 15px;
      padding: 15px;
      box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.8);
    }

    .reel {
      width: 110px;
      height: 240px;
      background: linear-gradient(180deg, #1a1a2e 0%, #000000 30%, #0a0a0a 70%, #1a1a2e 100%);
      border: 3px solid var(--chrome);
      border-radius: 10px;
      overflow: hidden;
      position: relative;
      box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.8);
    }

    .symbol-track {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-around;
      height: 100%;
      padding: 10px 0;
    }

    .symbol-track img {
      width: var(--symbol-size);
      height: var(--symbol-size);
      object-fit: contain;
      border-radius: 10px;
      transition: all 0.3s ease;
      filter: drop-shadow(0 0 5px rgba(255, 182, 18, 0.3));
    }

    .reel.spinning .symbol-track {
      animation: spin 0.1s linear infinite;
    }

    @keyframes spin {
      0% { transform: translateY(0); }
      100% { transform: translateY(-100px); }
    }

    .controls-section {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      gap: 20px;
      align-items: center;
      margin-bottom: 15px;
    }

    .betting-controls {
      display: flex;
      flex-direction: column;
      gap: 10px;
      align-items: center;
    }

    .bet-buttons {
      display: flex;
      gap: 10px;
    }

    .bet-button {
      background: linear-gradient(145deg, var(--nfl-blue), #001a33);
      color: white;
      border: 2px solid var(--nfl-gold);
      border-radius: 8px;
      padding: 8px 15px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .bet-button:hover {
      background: linear-gradient(145deg, #001a33, var(--nfl-blue));
      box-shadow: 0 0 15px var(--nfl-gold);
    }

    .spin-button {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: radial-gradient(circle, var(--nfl-gold) 0%, #cc9500 100%);
      border: 6px solid var(--chrome);
      color: var(--nfl-blue);
      font-size: 18px;
      font-weight: 900;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 
        0 0 20px rgba(255, 182, 18, 0.5),
        inset 0 0 10px rgba(255, 255, 255, 0.2);
    }

    .spin-button:hover {
      transform: scale(1.05);
      box-shadow: 
        0 0 30px rgba(255, 182, 18, 0.8),
        inset 0 0 15px rgba(255, 255, 255, 0.3);
    }

    .spin-button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .info-displays {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
    }

    .info-display {
      background: var(--secondary-bg);
      border: 2px solid var(--border-color);
      border-radius: 10px;
      padding: 15px;
      text-align: center;
      box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
    }

    .info-label {
      font-size: 0.8rem;
      color: var(--nfl-silver);
      margin-bottom: 5px;
      font-weight: normal;
    }

    .info-value {
      font-size: 1.2rem;
      font-weight: 900;
      color: var(--nfl-gold);
    }

    .win-overlay {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      background: radial-gradient(circle, rgba(255, 215, 0, 0.9), rgba(255, 165, 0, 0.9));
      color: var(--nfl-blue);
      padding: 30px;
      border-radius: 20px;
      font-size: 2rem;
      font-weight: 900;
      text-align: center;
      z-index: 1000;
      transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      pointer-events: none;
    }

    .win-overlay.visible {
      transform: translate(-50%, -50%) scale(1);
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .slot-machine {
        padding: 20px;
        margin: 10px;
      }

      .reels-container {
        gap: 10px;
        padding: 15px;
      }

      .reel {
        width: 90px;
        height: 220px;
      }

      :root {
        --symbol-size: 60px;
      }

      .machine-title {
        font-size: 1.5rem;
      }

      .controls-section {
        grid-template-columns: 1fr;
        gap: 20px;
      }

      .spin-button {
        width: 80px;
        height: 80px;
        font-size: 16px;
      }

      .info-displays {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    /* Win effects */
    .winning-symbol {
      animation: symbolGlow 1s ease-in-out infinite alternate;
    }

    @keyframes symbolGlow {
      0% { 
        filter: drop-shadow(0 0 5px rgba(255, 182, 18, 0.3));
        transform: scale(1);
      }
      100% { 
        filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.8));
        transform: scale(1.1);
      }
    }
  </style>
</head>
<body>
  <div class="game-container">
    <div class="slot-machine">
      <div class="led-lights">
        <div class="led-light"></div>
        <div class="led-light"></div>
        <div class="led-light"></div>
        <div class="led-light"></div>
      </div>

      <div class="machine-header">
        <img src="./logos/nfl.png" alt="NFL Logo" class="nfl-logo" onerror="this.style.display='none'">
        <h1 class="machine-title">NFL SLOTS 2</h1>
        <p class="subtitle">Complete Team Collection</p>
      </div>

      <div class="reels-container">
        <div class="reel" id="reel1">
          <div class="symbol-track">
            <!-- Symbols will be populated by JavaScript -->
          </div>
        </div>
        
        <div class="reel" id="reel2">
          <div class="symbol-track">
            <!-- Symbols will be populated by JavaScript -->
          </div>
        </div>
        
        <div class="reel" id="reel3">
          <div class="symbol-track">
            <!-- Symbols will be populated by JavaScript -->
          </div>
        </div>
      </div>

      <div class="controls-section">
        <div class="betting-controls">
          <div class="info-label">BET AMOUNT</div>
          <div class="bet-buttons">
            <button class="bet-button bet-down">-</button>
            <button class="bet-button max-bet">MAX</button>
            <button class="bet-button bet-up">+</button>
          </div>
        </div>

        <button class="spin-button" id="spin-button">
          SPIN
        </button>

        <div class="betting-controls">
          <div class="info-label">AUTOPLAY</div>
          <button class="bet-button autoplay-button">OFF</button>
        </div>
      </div>

      <div class="info-displays">
        <div class="info-display">
          <div class="info-label">CREDITS</div>
          <div class="info-value" id="credits-display">1000</div>
        </div>
        <div class="info-display">
          <div class="info-label">BET</div>
          <div class="info-value" id="bet-display">10</div>
        </div>
        <div class="info-display">
          <div class="info-label">WIN</div>
          <div class="info-value" id="win-display">0</div>
        </div>
        <div class="info-display">
          <div class="info-label">JACKPOT</div>
          <div class="info-value" id="jackpot-display">10000</div>
        </div>
      </div>

      <div class="win-overlay" id="win-overlay">
        <!-- Win message will appear here -->
      </div>
    </div>
  </div>

  <script>
    class NFLSlots2 {
      constructor() {
        // Game state
        this.credits = 1000;
        this.bet = 10;
        this.minBet = 5;
        this.maxBet = 100;
        this.win = 0;
        this.jackpot = 10000;
        this.isSpinning = false;
        this.autoplay = false;
        this.autoplayInterval = null;

        // DOM elements
        this.elements = {
          reels: document.querySelectorAll('.reel'),
          spinButton: document.getElementById('spin-button'),
          creditsDisplay: document.getElementById('credits-display'),
          betDisplay: document.getElementById('bet-display'),
          winDisplay: document.getElementById('win-display'),
          jackpotDisplay: document.getElementById('jackpot-display'),
          winOverlay: document.getElementById('win-overlay'),
          betUpButton: document.querySelector('.bet-up'),
          betDownButton: document.querySelector('.bet-down'),
          maxBetButton: document.querySelector('.max-bet'),
          autoplayButton: document.querySelector('.autoplay-button')
        };

        // NFL Division mapping for proper division matching
        this.nflDivisions = {
          'AFC East': ['Patriots', 'Bills', 'Dolphins', 'Jets'],
          'AFC North': ['Ravens', 'Steelers', 'Browns', 'Bengals'],
          'AFC South': ['Titans', 'Colts', 'Texans', 'Jaguars'],
          'AFC West': ['Chiefs', 'Chargers', 'Raiders', 'Broncos'],
          'NFC East': ['Eagles', 'Cowboys', 'Giants', 'Commanders'],
          'NFC North': ['Packers', 'Vikings', 'Bears', 'Lions'],
          'NFC South': ['Saints', 'Buccaneers', 'Falcons', 'Panthers'],
          'NFC West': ['49ers', 'Seahawks', 'Rams', 'Cardinals']
        };

        // Complete NFL Teams Database with all available logos
        this.teams = [
          // Special symbols
          { name: 'NFL Shield', image: './logos/nfl.png', value: 500, isWild: true, isPremium: true },
          { name: 'Trophy', image: './logos/trophy.png', value: 5000, isJackpot: true, isPremium: true, isWild: true },
          { name: 'AFC', image: './logos/afc.png', value: 200, isPremium: true },
          { name: 'NFC', image: './logos/nfc.png', value: 200, isPremium: true },
          
          // AFC East
          { name: 'Patriots', image: './logos/patriots.png', value: 150 },
          { name: 'Bills', image: './logos/bills.png', value: 130 },
          { name: 'Dolphins', image: './logos/dolphins.png', value: 120 },
          { name: 'Jets', image: './logos/jets.png', value: 110 },
          
          // AFC North
          { name: 'Ravens', image: './logos/ravens.png', value: 140 },
          { name: 'Steelers', image: './logos/steelers.png', value: 135 },
          { name: 'Browns', image: './logos/browns.png', value: 115 },
          { name: 'Bengals', image: './logos/bengals.png', value: 125 },
          
          // AFC South
          { name: 'Titans', image: './logos/titans.png', value: 105 },
          { name: 'Colts', image: './logos/colts.png', value: 120 },
          { name: 'Texans', image: './logos/texans.png', value: 110 },
          { name: 'Jaguars', image: './logos/jaguars.png', value: 100 },
          
          // AFC West
          { name: 'Chiefs', image: './logos/chiefs.png', value: 160 },
          { name: 'Chargers', image: './logos/chargers.png', value: 125 },
          { name: 'Raiders', image: './logos/raiders.png', value: 115 },
          { name: 'Broncos', image: './logos/broncos.png', value: 120 },
          
          // NFC East
          { name: 'Eagles', image: './logos/eagles.png', value: 145 },
          { name: 'Cowboys', image: './logos/cowboys.png', value: 140 },
          { name: 'Giants', image: './logos/giants.png', value: 115 },
          { name: 'Commanders', image: './logos/commanders.png', value: 110 },
          
          // NFC North
          { name: 'Packers', image: './logos/packers.png', value: 135 },
          { name: 'Vikings', image: './logos/vikings.png', value: 120 },
          { name: 'Bears', image: './logos/bears.png', value: 110 },
          { name: 'Lions', image: './logos/lions.png', value: 125 },
          
          // NFC South
          { name: 'Saints', image: './logos/saints.png', value: 125 },
          { name: 'Buccaneers', image: './logos/buccaneers.png', value: 130 },
          { name: 'Falcons', image: './logos/falcons.png', value: 115 },
          { name: 'Panthers', image: './logos/panthers.png', value: 105 },
          
          // NFC West
          { name: '49ers', image: './logos/49ers.png', value: 140 },
          { name: 'Seahawks', image: './logos/seahawks.png', value: 125 },
          { name: 'Rams', image: './logos/rams.png', value: 130 },
          { name: 'Cardinals', image: './logos/cardinals.png', value: 110 }
        ];

        // Sound system
        this.sounds = {
          spin: null,
          stop: null,
          win: null,
          lose: null
        };

        this.spinDuration = 2000;
        this.reelStopDelay = 500;

        this.init();
      }

      init() {
        this.validateElements();
        this.initSounds();
        this.initEventListeners();
        this.initReels();
        this.updateDisplays();
        console.log('🎰 NFL Slots 2 initialized successfully with', this.teams.length, 'teams!');
      }

      initSounds() {
        // Create audio elements for sound effects
        const soundFiles = {
          spin: './sounds/spin.wav',
          stop: './sounds/stop.wav',
          win: './sounds/win.wav',
          lose: './sounds/lose.wav'
        };

        Object.entries(soundFiles).forEach(([key, file]) => {
          this.sounds[key] = new Audio(file);
          if (this.sounds[key]) {
            this.sounds[key].preload = 'auto';
            this.sounds[key].volume = 0.7;

            // Error handling for missing sound files
            this.sounds[key].onerror = () => {
              console.warn(`Sound file not found: ${file}`);
              this.sounds[key] = null;
            };
          }
        });
      }

      playSound(soundName) {
        if (this.sounds[soundName]) {
          this.sounds[soundName].currentTime = 0;
          this.sounds[soundName].play().catch(e => {
            console.warn(`Failed to play sound: ${soundName}`, e);
          });
        }
      }

      validateElements() {
        const missingElements = [];
        Object.entries(this.elements).forEach(([key, element]) => {
          if (!element || (element.length === 0)) {
            missingElements.push(key);
          }
        });
        
        if (missingElements.length > 0) {
          console.error('Missing DOM elements:', missingElements);
        }
      }

      initEventListeners() {
        this.elements.spinButton?.addEventListener('click', () => this.spin());
        this.elements.betUpButton?.addEventListener('click', () => this.adjustBet(5));
        this.elements.betDownButton?.addEventListener('click', () => this.adjustBet(-5));
        this.elements.maxBetButton?.addEventListener('click', () => this.setMaxBet());
        this.elements.autoplayButton?.addEventListener('click', () => this.toggleAutoplay());
        
        // Keyboard controls
        document.addEventListener('keydown', (e) => {
          if (e.code === 'Space') {
            e.preventDefault();
            this.spin();
          }
        });
      }

      initReels() {
        this.elements.reels.forEach((reel, index) => {
          const track = reel.querySelector('.symbol-track');
          if (track) {
            this.setReelSymbols(index, this.getRandomReelSymbols());
          }
        });
      }

      getRandomSymbol() {
        return this.teams[Math.floor(Math.random() * this.teams.length)];
      }

      getRandomReelSymbols() {
        return [this.getRandomSymbol(), this.getRandomSymbol(), this.getRandomSymbol()];
      }

      setReelSymbols(reelIndex, symbols) {
        const reel = this.elements.reels[reelIndex];
        if (!reel) return;

        const track = reel.querySelector('.symbol-track');
        if (!track) return;

        // Ensure exactly 3 symbols
        while (symbols.length < 3) {
          symbols.push(this.teams[0]); // Add NFL Shield as fallback
        }
        symbols = symbols.slice(0, 3);

        track.innerHTML = '';
        symbols.forEach(symbol => {
          const img = document.createElement('img');
          img.src = symbol.image;
          img.alt = symbol.name;
          img.setAttribute('data-symbol', symbol.name);
          img.onerror = () => {
            img.src = this.createFallbackSVG(symbol);
          };
          track.appendChild(img);
        });
      }

      createFallbackSVG(symbol) {
        const colorMap = {
          'NFL Shield': { bg: '#FFB612', text: '#000', label: '🏈' },
          'Trophy': { bg: '#FFD700', text: '#000', label: '🏆' },
          'AFC': { bg: '#FF0000', text: '#FFF', label: 'AFC' },
          'NFC': { bg: '#0066CC', text: '#FFF', label: 'NFC' },
          'Patriots': { bg: '#002244', text: '#FFF', label: 'NE' },
          'Bills': { bg: '#00338D', text: '#FFF', label: 'BUF' },
          'Dolphins': { bg: '#008E97', text: '#FFF', label: 'MIA' },
          'Jets': { bg: '#125740', text: '#FFF', label: 'NYJ' },
          'Ravens': { bg: '#241773', text: '#FFF', label: 'BAL' },
          'Steelers': { bg: '#FFB612', text: '#000', label: 'PIT' },
          'Browns': { bg: '#311D00', text: '#FFF', label: 'CLE' },
          'Bengals': { bg: '#FB4F14', text: '#FFF', label: 'CIN' },
          'Titans': { bg: '#0C2340', text: '#FFF', label: 'TEN' },
          'Colts': { bg: '#002C5F', text: '#FFF', label: 'IND' },
          'Texans': { bg: '#03202F', text: '#FFF', label: 'HOU' },
          'Jaguars': { bg: '#006778', text: '#FFF', label: 'JAX' },
          'Chiefs': { bg: '#E31837', text: '#FFF', label: 'KC' },
          'Chargers': { bg: '#0080C6', text: '#FFF', label: 'LAC' },
          'Raiders': { bg: '#000000', text: '#FFF', label: 'LV' },
          'Broncos': { bg: '#FB4F14', text: '#FFF', label: 'DEN' },
          'Eagles': { bg: '#004C54', text: '#FFF', label: 'PHI' },
          'Cowboys': { bg: '#003594', text: '#FFF', label: 'DAL' },
          'Giants': { bg: '#0B2265', text: '#FFF', label: 'NYG' },
          'Commanders': { bg: '#5A1414', text: '#FFF', label: 'WAS' },
          'Packers': { bg: '#203731', text: '#FFF', label: 'GB' },
          'Vikings': { bg: '#4F2683', text: '#FFF', label: 'MIN' },
          'Bears': { bg: '#0B162A', text: '#FFF', label: 'CHI' },
          'Lions': { bg: '#0076B6', text: '#FFF', label: 'DET' },
          'Saints': { bg: '#D3BC8D', text: '#000', label: 'NO' },
          'Buccaneers': { bg: '#D50A0A', text: '#FFF', label: 'TB' },
          'Falcons': { bg: '#A71930', text: '#FFF', label: 'ATL' },
          'Panthers': { bg: '#0085CA', text: '#FFF', label: 'CAR' },
          '49ers': { bg: '#AA0000', text: '#FFF', label: 'SF' },
          'Seahawks': { bg: '#002244', text: '#FFF', label: 'SEA' },
          'Rams': { bg: '#003594', text: '#FFF', label: 'LAR' },
          'Cardinals': { bg: '#97233F', text: '#FFF', label: 'ARI' }
        };

        const colors = colorMap[symbol.name] || { bg: '#333333', text: '#FFF', label: symbol.name.substring(0, 3).toUpperCase() };
        
        const svg = `
          <svg width="80" height="80" viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
            <rect width="80" height="80" fill="${colors.bg}" rx="10"/>
            <text x="40" y="50" font-family="Arial" font-size="16" font-weight="bold" 
                  text-anchor="middle" fill="${colors.text}">${colors.label}</text>
          </svg>
        `;
        
        return 'data:image/svg+xml;base64,' + btoa(svg);
      }

      adjustBet(amount) {
        if (this.isSpinning) return;
        const newBet = Math.max(this.minBet, Math.min(this.maxBet, this.bet + amount));
        if (newBet !== this.bet) {
          this.bet = newBet;
          this.updateDisplays();
        }
      }

      setMaxBet() {
        if (this.isSpinning) return;
        this.bet = this.maxBet;
        this.updateDisplays();
      }

      toggleAutoplay() {
        this.autoplay = !this.autoplay;
        this.elements.autoplayButton.textContent = this.autoplay ? 'ON' : 'OFF';
        
        if (this.autoplay) {
          this.autoplayInterval = setInterval(() => {
            if (!this.isSpinning && this.credits >= this.bet) {
              this.spin();
            } else if (this.credits < this.bet) {
              this.toggleAutoplay();
            }
          }, 3000);
        } else {
          clearInterval(this.autoplayInterval);
        }
      }

      async spin() {
        if (this.isSpinning || this.credits < this.bet) {
          if (this.credits < this.bet) {
            this.showWinMessage('INSUFFICIENT CREDITS!');
          }
          return;
        }

        this.isSpinning = true;
        this.elements.spinButton.disabled = true;
        this.credits -= this.bet;
        this.win = 0;
        this.updateDisplays();

        // Play spin sound
        this.playSound('spin');

        // Start spinning animation
        this.elements.reels.forEach(reel => {
          reel.classList.add('spinning');
          const track = reel.querySelector('.symbol-track');
          
          // Rapidly change symbols during spin
          const spinInterval = setInterval(() => {
            const symbols = this.getRandomReelSymbols();
            this.setReelSymbols(Array.from(this.elements.reels).indexOf(reel), symbols);
          }, 100);

          // Store interval for cleanup
          reel.spinInterval = spinInterval;
        });

        // Stop reels one by one
        const finalSymbols = [];
        for (let i = 0; i < 3; i++) {
          await new Promise(resolve => {
            setTimeout(() => {
              const reel = this.elements.reels[i];
              reel.classList.remove('spinning');
              clearInterval(reel.spinInterval);
              
              const symbols = this.getRandomReelSymbols();
              finalSymbols.push(symbols[1]); // Take middle symbol
              this.setReelSymbols(i, symbols);
              
              // Play stop sound for each reel
              this.playSound('stop');
              
              resolve();
            }, this.spinDuration + (i * this.reelStopDelay));
          });
        }

        // Evaluate win
        this.evaluateWin(finalSymbols);
        
        this.isSpinning = false;
        this.elements.spinButton.disabled = false;
      }

      evaluateWin(symbols) {
        console.log('Evaluating symbols:', symbols.map(s => s.name));
        
        // Check for jackpot (3 trophies)
        if (symbols.every(symbol => symbol.isJackpot)) {
          this.win = this.jackpot;
          this.showWinMessage('🏆 JACKPOT! 🏆');
          this.highlightWinningSymbols();
          return;
        }

        // Check for wild combinations (NFL Shield and Trophy)
        const wildCount = symbols.filter(symbol => symbol.isWild).length;
        const nflShieldCount = symbols.filter(symbol => symbol.name === 'NFL Shield').length;
        const trophyCount = symbols.filter(symbol => symbol.name === 'Trophy').length;
        
        // Special case: 3 different wilds (Trophy + NFL Shield combinations)
        if (wildCount === 3 && trophyCount > 0 && nflShieldCount > 0) {
          this.win = this.bet * 75; // Bonus for mixed wilds
          this.showWinMessage('🏆 ULTIMATE WILD COMBINATION! 🏆');
          this.highlightWinningSymbols();
        }
        // Pure NFL Shield combinations
        else if (nflShieldCount === 3) {
          this.win = this.bet * 50;
          this.showWinMessage('🏈 NFL SHIELD BONUS! 🏈');
          this.highlightWinningSymbols();
        } else if (nflShieldCount === 2) {
          this.win = this.bet * 20;
          this.showWinMessage('BIG SHIELD WIN!');
          this.highlightWinningSymbols();
        }
        // Pure Trophy wild combinations (not jackpot)
        else if (trophyCount === 2) {
          this.win = this.bet * 25;
          this.showWinMessage('🏆 TROPHY WILD WIN! 🏆');
          this.highlightWinningSymbols();
        }
        // Mixed wild combinations
        else if (wildCount === 2) {
          this.win = this.bet * 15;
          this.showWinMessage('WILD PAIR!');
          this.highlightWinningSymbols();
        } else if (wildCount === 1) {
          this.win = this.bet * 5;
          this.showWinMessage('WILD WIN!');
          this.highlightWinningSymbols();
        }

        // Check for three of a kind (same team)
        else if (symbols[0].name === symbols[1].name && symbols[1].name === symbols[2].name) {
          const symbol = symbols[0];
          this.win = Math.floor((symbol.value / 100) * this.bet);
          this.showWinMessage(`${symbol.name.toUpperCase()} WIN!`);
          this.highlightWinningSymbols();
        }

        // Check for premium symbols
        else if (symbols.some(symbol => symbol.isPremium)) {
          const premiumCount = symbols.filter(symbol => symbol.isPremium).length;
          if (premiumCount >= 2) {
            this.win = this.bet * (premiumCount * 2);
            this.showWinMessage('PREMIUM WIN!');
            this.highlightWinningSymbols();
          }
        }

        // Check for same division (proper NFL division matching)
        else {
          const divisionMatch = this.checkDivisionMatch(symbols);
          if (divisionMatch.count >= 2) {
            if (divisionMatch.count === 3) {
              this.win = this.bet * 5;
              this.showWinMessage(`🏈 ${divisionMatch.division.toUpperCase()} DIVISION SWEEP! 🏈`);
            } else {
              this.win = this.bet * 2;
              this.showWinMessage(`🏈 ${divisionMatch.division.toUpperCase()} DIVISION MATCH! 🏈`);
            }
            this.highlightWinningSymbols();
          }
        }

        if (this.win > 0) {
          this.credits += this.win;
          this.playSound('win');
          setTimeout(() => {
            this.clearWinEffects();
          }, 3000);
        } else {
          this.playSound('lose');
        }

        this.updateDisplays();
      }

      checkDivisionMatch(symbols) {
        // Get team names, treating wilds as potential matches
        const teamNames = symbols.map(symbol => {
          if (symbol.isWild) return null; // Wild cards don't count for division logic
          return symbol.name;
        }).filter(name => name !== null);

        // Find which division each team belongs to
        for (const [divisionName, teams] of Object.entries(this.nflDivisions)) {
          const matchingTeams = teamNames.filter(team => teams.includes(team));
          if (matchingTeams.length >= 2) {
            return {
              division: divisionName,
              count: matchingTeams.length,
              teams: matchingTeams
            };
          }
        }

        return { count: 0 };
      }

      showWinMessage(message) {
        this.elements.winOverlay.textContent = message;
        this.elements.winOverlay.classList.add('visible');
        
        setTimeout(() => {
          this.elements.winOverlay.classList.remove('visible');
        }, 2000);
      }

      highlightWinningSymbols() {
        this.elements.reels.forEach(reel => {
          const symbols = reel.querySelectorAll('img');
          symbols.forEach(symbol => {
            symbol.classList.add('winning-symbol');
          });
        });
      }

      clearWinEffects() {
        document.querySelectorAll('.winning-symbol').forEach(symbol => {
          symbol.classList.remove('winning-symbol');
        });
      }

      updateDisplays() {
        this.elements.creditsDisplay.textContent = this.credits;
        this.elements.betDisplay.textContent = this.bet;
        this.elements.winDisplay.textContent = this.win;
        this.elements.jackpotDisplay.textContent = this.jackpot;
      }
    }

    // Initialize the game when the page loads
    document.addEventListener('DOMContentLoaded', () => {
      window.nflSlots2 = new NFLSlots2();
    });
  </script>
</body>
</html>
