<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>OctoSlots - GitHub Octocat Slot Machine</title>
  <!-- ... styles unchanged ... -->
  <!-- (SKIP: styles omitted for brevity, same as your file) -->
</head>
<body>
  <header class="app-header">
    <div class="user-info">Welcome, BensBar</div>
    <div class="game-title">OctoSlots</div>
    <div class="date-info">2025-06-02 13:07:23</div>
  </header>
  <!-- Audio elements embedded in the page -->
  <audio id="spin-sound" src="sounds/spin.wav" preload="auto"></audio>
  <audio id="stop-sound" src="sounds/stop.wav" preload="auto"></audio>
  <audio id="win-sound" src="sounds/win.wav" preload="auto"></audio>
  <audio id="win2-sound" src="sounds/win2.wav" preload="auto"></audio>
  <audio id="win3-sound" src="sounds/win3.wav" preload="auto"></audio>
  <audio id="lose-sound" src="sounds/lose.wav" preload="auto"></audio>
  <div class="slot-machine-container">
    <div class="slot-machine">
      <!-- ... machine and paytable ... -->
      <button class="paytable-button">?</button>
      <div class="paytable">
        <!-- ... paytable content ... -->
      </div>
      <div class="machine-top">
        <div class="flashing-lights">
          <div class="light"></div><div class="light"></div><div class="light"></div><div class="light"></div>
          <div class="light"></div><div class="light"></div><div class="light"></div><div class="light"></div>
        </div>
        <div class="jackpot-display">JACKPOT: 1000</div>
      </div>
      <div class="reels-container">
        <div id="reel1" class="reel">
          <div class="slot-item top" id="reel1-top"></div>
          <div class="slot-item middle" id="reel1-middle"></div>
          <div class="slot-item bottom" id="reel1-bottom"></div>
        </div>
        <div id="reel2" class="reel">
          <div class="slot-item top" id="reel2-top"></div>
          <div class="slot-item middle" id="reel2-middle"></div>
          <div class="slot-item bottom" id="reel2-bottom"></div>
        </div>
        <div id="reel3" class="reel">
          <div class="slot-item top" id="reel3-top"></div>
          <div class="slot-item middle" id="reel3-middle"></div>
          <div class="slot-item bottom" id="reel3-bottom"></div>
        </div>
        <div id="win-line" class="win-line"></div>
      </div>
      <div class="controls">
        <div class="score-display">
          <div class="score-card"><h3>CREDITS</h3><div class="score-value" id="credits">500</div></div>
          <div class="score-card"><h3>BET</h3><div class="score-value" id="bet-amount">10</div></div>
          <div class="score-card"><h3>WIN</h3><div class="score-value" id="win-amount">0</div></div>
        </div>
        <button class="spin-button" id="spin-button">SPIN</button>
      </div>
      <div class="win-message" id="win-message">
        <h2>WINNER!</h2>
        <p>You won <span id="win-value">250</span> credits!</p>
        <button id="continue-button">CONTINUE</button>
      </div>
      <div class="lever-container">
        <div class="lever-base">
          <div class="lever" id="lever"></div>
        </div>
      </div>
    </div>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // ... (other code unchanged) ...
      // (from your existing code - fetch/check soundAvailability, octocats array, etc.)

      // --- Audio Section ---
      const sounds = {
        spin: document.getElementById('spin-sound'),
        stop: document.getElementById('stop-sound'),
        win: document.getElementById('win-sound'),
        win2: document.getElementById('win2-sound'),
        win3: document.getElementById('win3-sound'),
        lose: document.getElementById('lose-sound')
      };
      Object.values(sounds).forEach(sound => { if (sound) sound.volume = 1.0; });

      // Always keep reference to current spin sound
      let spinSoundInstance = null;

      function playSpinSound() {
        if (spinSoundInstance) {
          spinSoundInstance.pause();
          spinSoundInstance.currentTime = 0;
        }
        // Always reset and play
        spinSoundInstance = sounds.spin;
        if (spinSoundInstance) {
          spinSoundInstance.currentTime = 0;
          spinSoundInstance.loop = true;
          spinSoundInstance.play().catch(e => console.log("Spin sound error:", e));
        }
      }
      function stopSpinSound() {
        if (spinSoundInstance) {
          spinSoundInstance.pause();
          spinSoundInstance.currentTime = 0;
          spinSoundInstance.loop = false;
        }
      }

      // --- DOM & State Section (unchanged) ---

      // --- SPIN FUNCTION ---
      async function spinAllReels() {
        if (state.spinning) return;

        // Hide win box immediately if present (FIX 2)
        elements.winMessage.classList.remove('show');

        // ... your checks for credits, etc. ...
        if (state.credits < state.bet) {
          alert('Not enough credits!');
          return;
        }

        unlockAudio();

        // Start SPIN SOUND before reels start (FIX 1)
        playSpinSound();

        state.credits -= state.bet;
        updateDisplay();

        state.spinning = true;
        state.lastWin = 0;
        elements.spinButton.disabled = true;
        elements.winLine.classList.remove('highlight');
        startLights();

        const finalSymbols = determineWinningSymbols();
        elements.reels.forEach(reel => reel.classList.add('spinning'));
        const spinningIntervals = elements.reels.map((reel, reelIndex) => {
          return setInterval(() => {
            setRandomSymbol(elements.slotItems.top[reelIndex]);
            setRandomSymbol(elements.slotItems.middle[reelIndex]);
            setRandomSymbol(elements.slotItems.bottom[reelIndex]);
          }, 100);
        });

        for (let i = 0; i < 3; i++) {
          await new Promise(resolve => {
            setTimeout(() => {
              clearInterval(spinningIntervals[i]);
              elements.reels[i].classList.remove('spinning');
              const otherSymbol1 = octocats[Math.floor(Math.random() * octocats.length)].name;
              const otherSymbol2 = octocats[Math.floor(Math.random() * octocats.length)].name;
              setSymbol(elements.slotItems.top[i], otherSymbol1);
              setSymbol(elements.slotItems.middle[i], finalSymbols[i]);
              setSymbol(elements.slotItems.bottom[i], otherSymbol2);
              state.currentSymbols[i] = finalSymbols[i];
              playSound('stop');
              // Stop SPIN SOUND immediately after last reel (FIX 1)
              if (i === 2) {
                stopSpinSound();
              }
              resolve();
            }, config.spinDuration + (i * config.stopDelay));
          });
        }

        await checkWin();
        state.spinning = false;
        elements.spinButton.disabled = false;
      }

      // --- SPIN BUTTON EVENT ---
      elements.spinButton.addEventListener('click', () => {
        spinAllReels();
      });

      // --- Other event listeners & game logic unchanged ---

      // ... (rest of your JS code unchanged) ...
    });
  </script>
</body>
</html>