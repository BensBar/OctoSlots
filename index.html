<html lang="en"><head>
  <!-- Set the character encoding for the document -->
  <meta charset="UTF-8">
  <!-- Make the page responsive on all devices -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <!-- Page title -->
  <title>OctoSlots 4K Edition</title>
  <!-- CSS styles for the slot machine game -->
  <style>
    /* Default color variables for dark mode */
    :root {
      --bg-color: #fff;
      --text-color: #222;
      --border-color: #bfa100;
      --slot-bg: #f7ecd2;
      --button-bg: #bfa100;
      --button-color: #fff;
      --reel-glow: 0 0 32px 8px #bfa10099;
      --reel-radius: 2.5rem;
      --symbol-size: 7rem;
      --symbol-gap: 0;
      --reel-drum: linear-gradient(180deg, #fff8 0%, #fff 50%, #fff8 100%), radial-gradient(ellipse at 50% 40%, #fff6 0%, #fff0 80%), #f7ecd2;
      --reel-shadow: 0 0 32px 8px #FFD70044, 0 0 0 8px #fff1 inset;
      --bg-gradient: linear-gradient(135deg, #fffbe9 0%, #f7ecd2 100%);
      --machine-bg: linear-gradient(180deg, #e0e0e0 0%, #b0b0b0 100%);
      --arch-bg: #fff;
      --paytable-bg: #fff;
      --paytable-color: #222;
    }
    body:not(.light) {
      --bg-color: #000;
      --text-color: #fff;
      --border-color: #FFD700;
      --slot-bg: #181818;
      --button-bg: #e53935;
      --button-color: #fff;
      --reel-glow: 0 0 32px 8px #FFD70099;
      --reel-drum: linear-gradient(180deg, #222 0%, #111 50%, #222 100%), radial-gradient(ellipse at 50% 40%, #fff1 0%, #fff0 80%), #181818;
      --bg-gradient: linear-gradient(135deg, #000 0%, #222 100%);
      --machine-bg: #000;
      --arch-bg: #000;
      --paytable-bg: #111;
      --paytable-color: #fff;
    }
    .slot-arch-frame {
      background: var(--machine-bg) !important;
    }
    .slot-arch-top {
      background: var(--arch-bg) !important;
      background-image: none !important;
    }
    .slot-base {
      background: var(--arch-bg) !important;
    }
    body {
      background: var(--bg-gradient);
      color: var(--text-color);
    }
    .slot-arch-frame {
      background: var(--machine-bg);
    }
    .slot-arch-top {
      background: var(--arch-bg);
      background-image: none;
    }
    .slot-base {
      background: var(--arch-bg);
    }
    .pay-table {
      background: var(--paytable-bg);
      color: var(--paytable-color);
      box-shadow: 0 2px 8px #0002, 0 0 0 2px #fff8 inset;
      margin: 1.2rem auto 0 auto;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      gap: 0.3rem;
      border-radius: 1.2rem;
      padding: 0.5rem 0.7rem;
      max-width: 98vw;
      font-size: 0.98rem;
      align-items: flex-start;
      width: 100%;
      min-width: 0;
    }
    .pay-row {
      display: flex;
      align-items: center;
      gap: 0.3rem;
      font-weight: 600;
      color: inherit;
      letter-spacing: 0.04em;
      margin: 0 0.1rem;
      flex-wrap: wrap;
    }
    .pay-symbol {
      width: 1.3rem;
      height: 1.3rem;
      object-fit: contain;
      filter: drop-shadow(0 1px 2px #0003);
      border-radius: 0.3rem;
      background: #fff;
      margin-right: 0.1rem;
      flex-shrink: 0;
    }
    .pay-label {
      color: inherit;
      font-size: 0.98rem;
      font-weight: 500;
      margin-right: 0.1rem;
      white-space: nowrap;
    }
    .pay-mult {
      color: #bfa100;
      font-size: 1rem;
      font-weight: 700;
      margin-left: 0.1rem;
      text-shadow: 0 0 4px #fff, 0 0 8px #ffd700;
      white-space: nowrap;
    }
    body:not(.light) .pay-mult {
      color: #e53935;
      text-shadow: 0 0 4px #fff, 0 0 8px #e53935;
    }
    @media (max-width: 600px) {
      .pay-table {
        padding: 0.4rem 0.2rem;
        font-size: 0.92rem;
      }
      .pay-symbol {
        width: 1.1rem;
        height: 1.1rem;
      }
      .pay-label, .pay-mult {
        font-size: 0.92rem;
      }
    }

    /* Main body styles */
    body {
      margin: 0;
      min-height: 100vh;
      background: var(--bg-gradient);
      font-family: 'Segoe UI', 'Arial', 'Helvetica Neue', Arial, sans-serif;
      overflow: hidden;
      color: var(--text-color);
      background-size: 200% 200%;
      animation: bgmove 18s ease-in-out infinite;
    }

    @keyframes bgmove {
      0% { background-position: 0% 0%; }
      50% { background-position: 100% 100%; }
      100% { background-position: 0% 0%; }
    }
    /* Container for all game content */
    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      padding-top: 4rem;
      box-sizing: border-box;
    }
    /* Remove old .header, add arched title and emoji styles */
    .slot-arch-title-arc {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      margin-top: -1.2rem; /* Raise the whole title/emoji group */
      margin-bottom: 0.2rem;
      position: relative;
      z-index: 3;
    }
    .slot-arch-title-arc svg {
      width: 100%;
      height: 80px;
      overflow: visible;
      margin-bottom: -0.7rem;
    }
    .slot-arch-title-arc text {
      font-family: 'Segoe UI', 'Arial', 'Helvetica Neue', Arial, sans-serif;
      text-shadow: 0 0 16px #fff, 0 0 32px #b71c1c;
    }
    .slot-arch-emoji {
      font-size: 3.2rem;
      color: #fff;
      text-shadow: 0 0 16px #fff, 0 0 32px #b71c1c;
      margin-top: -0.2rem;
      margin-bottom: 0.2rem;
      text-align: center;
      width: 100%;
      pointer-events: none;
    }
    .slot-arch-label {
      font-size: 1.5rem;
      color: #fff;
      text-shadow: 0 0 8px #b71c1c, 0 0 16px #fff;
      font-weight: 600;
      margin-top: 0.1rem;
      letter-spacing: 0.12em;
      text-align: center;
      pointer-events: none;
    }

    /* Button to toggle light/dark mode */
    .toggle-mode {
      position: absolute;
      top: 1.5rem;
      right: 2rem;
      background: var(--button-bg);
      color: var(--button-color);
      border: none;
      padding: 0.7rem 1.2rem;
      border-radius: 1rem;
      cursor: pointer;
      font-size: 1.1rem;
      box-shadow: 0 2px 12px #0006;
      transition: background 0.2s;
    }
    .toggle-mode:hover {
      background: #b71c1c;
    }
    /* Slot machine reels container */
    .reels {
      display: flex;
      overflow: visible;
      height: 18rem;
      width: 36rem;
      max-width: 95vw;
      border: 6px solid #bfa100;
      border-radius: var(--reel-radius);
      box-shadow: 0 0 64px 16px #FFD70055, 0 0 0 12px #fff2 inset, 0 8px 32px #000a, 0 0 0 8px #fff4 inset;
      background: var(--slot-bg);
      position: relative;
      margin-bottom: 2rem;
      background-image: linear-gradient(180deg, #fff2 0%, #fff0 100%), repeating-linear-gradient(90deg, #fff1 0 2px, transparent 2px 12px);
      border-top: 10px solid #fff8;
      border-bottom: 10px solid #fff8;
    }
    /* Slot machine handle */
    .slot-handle {
      position: absolute;
      right: -3.5rem;
      top: 2.5rem; /* Move handle to top of lever */
      transform: none;
      width: 2.2rem;
      height: 10rem;
      background: linear-gradient(90deg, #bbb 0%, #fff 60%, #bbb 100%);
      border-radius: 1.2rem;
      box-shadow: 2px 0 12px #0006;
      z-index: 30;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start; /* knob at top */
      transition: top 0.3s cubic-bezier(.4,2,.6,1), transform 0.3s cubic-bezier(.4,2,.6,1);
    }
    .slot-handle.pulled {
      top: 7.5rem; /* Animate handle down when pulled */
    }
    .slot-handle-knob {
      width: 2.7rem;
      height: 2.7rem;
      background: radial-gradient(circle at 60% 40%, #fff 0%, #e53935 60%, #b71c1c 100%);
      border-radius: 50%;
      box-shadow: 0 0 16px 4px #e5393588, 0 2px 8px #0006;
      margin-top: -1.2rem;
      border: 3px solid #fff8;
      cursor: pointer;
      transition: box-shadow 0.2s;
    }
    .slot-handle-knob:active {
      box-shadow: 0 0 32px 8px #e53935cc, 0 2px 8px #0006;
    }
    /* Individual reel styles */
    .reel {
      flex: 1;
      overflow: hidden;
      position: relative;
      border-left: 2px solid #444a;
      border-right: 2px solid #444a;
      border-radius: var(--reel-radius);
      margin: 0 0.2rem;
      /* Only apply glow to the first and second reels, not the third */
      background: var(--reel-drum);
      transition: box-shadow 0.3s, background 0.3s;
      /* Subtle highlight for drum effect */
      box-shadow: var(--reel-glow), 0 0 0 2px #fff4 inset;
    }
    .reel:last-child {
      box-shadow: none;
    }
    /* The strip of symbols inside each reel */
    .reel-strip {
      position: absolute;
      top: 0;
      width: 100%;
      left: 0;
      will-change: transform;
      transition: filter 0.2s;
    }
    /* Each symbol in the reel */
    .symbol {
      height: var(--symbol-size);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: var(--symbol-gap) 0;
      filter: drop-shadow(0 2px 8px #0008);
      background: none;
      border-radius: 0;
    }
    /* Symbol image styles */
    .symbol img {
      max-height: calc(var(--symbol-size) - 1.2rem);
      max-width: 90%;
      image-rendering: -webkit-optimize-contrast;
      image-rendering: crisp-edges;
      border-radius: 0 !important;
      background: none !important;
      box-shadow: none !important;
      border: none !important;
      transition: transform 0.2s;
      display: block;
    }
    .symbol img:active {
      transform: scale(0.95);
    }
    /* Controls section (spin button) */
    .controls {
      margin-top: 1.5rem;
      margin-bottom: 1.5rem;
    }
    /* Spin button styles */
    button.spin {
      font-size: 2rem;
      padding: 0.7em 2.5em;
      background: linear-gradient(90deg, #e53935 0%, #ffd700 100%);
      color: #fff;
      border: none;
      border-radius: 1.5rem;
      box-shadow: 0 4px 24px #ffd70055, 0 2px 8px #0008;
      cursor: pointer;
      font-weight: bold;
      letter-spacing: 0.1em;
      transition: background 0.2s, box-shadow 0.2s, transform 0.1s;
    }
    button.spin:active {
      background: linear-gradient(90deg, #ffd700 0%, #e53935 100%);
      transform: scale(0.97);
    }
    /* Jackpot display styles */
    .jackpot {
      margin-top: 1.5rem;
      font-size: 1.3rem;
      color: var(--jackpot-color, var(--border-color));
      text-shadow: 0 0 8px #ffd70088;
      font-weight: 600;
      letter-spacing: 0.05em;
      background: #222a;
      border-radius: 1rem;
      padding: 0.5rem 1.5rem;
      box-shadow: 0 2px 8px #0004;
      display: inline-block;
    }
    body.light .jackpot {
      --jackpot-color: #fff;
      background: #bfa100;
      text-shadow: 0 0 8px #fff, 0 0 16px #bfa100;
    }
    /* Sparkle effect for win animation */
    .sparkle {
      position: absolute;
      width: 10px;
      height: 10px;
      background: gold;
      border-radius: 50%;
      animation: sparkle 1s ease-out forwards;
    }
    /* Animation for sparkles */
    @keyframes sparkle {
      0% { opacity: 1; transform: scale(1); }
      100% { opacity: 0; transform: scale(3) translateY(-50px); }
    }
  
    /* Gold line that appears on win */
    /* Win line: perfectly centered, with animated glowing effect */
    .win-line {
      position: absolute;
      top: 50%;
      left: 0;
      width: 100%;
      height: 0.5rem;
      background: linear-gradient(90deg, #fff6 0%, gold 50%, #fff6 100%);
      box-shadow: 0 0 8px 2px gold, 0 0 16px 4px orange;
      z-index: 10;
      border-radius: 1rem;
      animation: winline-glow 1.2s infinite alternate;
      display: block;
      pointer-events: none;
      transform: translateY(-50%);
    }

    @keyframes winline-glow {
      0% {
        box-shadow: 0 0 8px 2px gold, 0 0 16px 4px orange;
        opacity: 1;
      }
      100% {
        box-shadow: 0 0 16px 4px gold, 0 0 32px 8px orange;
        opacity: 0.9;
      }
    }
    /* Banner that appears on win */
    .win-banner {
      position: absolute;
      top: 30%;
      width: 100%;
      text-align: center;
      font-size: 2.5rem;
      color: gold;
      text-shadow: 0 0 24px gold, 0 0 48px #fff8;
      display: none;
      z-index: 20;
      font-weight: 700;
      letter-spacing: 0.1em;
      pointer-events: none;
      animation: winbanner-glow 1.2s infinite alternate;
    }
    @keyframes winbanner-glow {
      0% { text-shadow: 0 0 24px gold, 0 0 48px #fff8; }
      100% { text-shadow: 0 0 48px gold, 0 0 96px #fff8; }
    }

    /* Slot machine arch and frame styles */
    .slot-arch-frame {
      position: relative;
      margin: 2rem auto 0 auto;
      width: 44rem;
      max-width: 98vw;
      min-height: 44rem;
      background: linear-gradient(180deg, #e0e0e0 0%, #b0b0b0 100%);
      border-radius: 2.5rem 2.5rem 2rem 2rem/6rem 6rem 2rem 2rem;
      box-shadow: 0 8px 48px #000a, 0 0 0 8px #fff4 inset;
      padding: 2.5rem 2.5rem 7.5rem 2.5rem; /* more bottom padding for base */
      display: flex;
      flex-direction: column;
      align-items: center;
      z-index: 1;
      overflow: visible;
    }
    .slot-arch-top {
      position: absolute;
      top: -2.5rem;
      left: 50%;
      transform: translateX(-50%);
      width: 38rem;
      height: 7rem;
      background: radial-gradient(ellipse at 50% 100%, #fff 0%, #e0e0e0 60%, #b0b0b0 100%);
      border-radius: 50% 50% 40% 40%/100% 100% 0 0;
      box-shadow: 0 2px 24px #fff8 inset, 0 8px 32px #0004;
      z-index: 2;
    }
    .slot-base {
      position: relative; /* was absolute */
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 40rem;
      height: 4.5rem;
      background: linear-gradient(180deg, #b0b0b0 0%, #888 100%);
      border-radius: 0 0 2.5rem 2.5rem/0 0 2.5rem 2.5rem;
      box-shadow: 0 2px 24px #0008, 0 0 0 8px #fff4 inset, 0 8px 32px #0004;
      z-index: 2;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 2.2rem;
      padding: 0 2rem;
      overflow: visible;
      margin-top: 1.5rem;
      border-top: 3px solid #fff8;
    }
    @media (max-width: 700px) {
      .slot-base {
        width: 98vw;
        gap: 0.7rem;
        padding: 0 0.2rem;
      }
      .slot-arch-frame {
        padding-bottom: 8.5rem;
      }
    }
    /* Blinky lights */
    .slot-arch-lights, .slot-arch-lights-bottom {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 0.7rem;
      z-index: 10;
      pointer-events: none;
    }
    .slot-arch-lights {
      top: 0.5rem;
      width: 38rem;
      height: 2.2rem;
      justify-content: center;
      align-items: flex-end;
    }
    .slot-arch-lights-bottom {
      bottom: 7.5rem;
      width: 36rem;
      height: 2.2rem;
      justify-content: center;
      align-items: flex-start;
    }
    .slot-arch-light {
      width: 1.3rem;
      height: 1.3rem;
      border-radius: 50%;
      background: radial-gradient(circle at 60% 40%, #fff 0%, #ffd700 60%, #bfa100 100%);
      box-shadow: 0 0 16px 4px #ffd70088, 0 2px 8px #0006;
      border: 2px solid #fff8;
      opacity: 0.7;
      animation: blink 1.2s infinite;
    }
    .slot-arch-light:nth-child(2n) { background: radial-gradient(circle at 60% 40%, #fff 0%, #ff5252 60%, #b71c1c 100%); animation-delay: 0.3s; }
    .slot-arch-light:nth-child(3n) { background: radial-gradient(circle at 60% 40%, #fff 0%, #40c4ff 60%, #01579b 100%); animation-delay: 0.6s; }
    .slot-arch-light:nth-child(4n) { background: radial-gradient(circle at 60% 40%, #fff 0%, #ffd740 60%, #ffab00 100%); animation-delay: 0.9s; }
    @keyframes blink {
      0%, 100% { opacity: 0.7; filter: brightness(1); }
      50% { opacity: 1; filter: brightness(1.7); }
    }
    
    /* Enhanced lights for dynamic control */
    .slot-arch-light.on {
      opacity: 1 !important;
      filter: brightness(2) !important;
      animation: none !important;
      box-shadow: 0 0 24px 8px currentColor, 0 2px 8px #0006;
    }
    /* Enhance reel window for glassy look */
    .reels {
      background: var(--slot-bg);
      background-image: linear-gradient(180deg, #fff2 0%, #fff0 100%), repeating-linear-gradient(90deg, #fff1 0 2px, transparent 2px 12px);
      box-shadow: 0 0 64px 16px #FFD70055, 0 0 0 12px #fff2 inset, 0 8px 32px #000a, 0 0 0 8px #fff4 inset;
      border: 6px solid #bfa100;
      border-radius: var(--reel-radius);
      position: relative;
      margin-bottom: 2rem;
      overflow: visible;
    }

    .slot-arch-title-arc {
      text-align: center;
      font-size: 2.8rem;
      fill: #fff;
      stroke: #b71c1c;
      stroke-width: 2;
      letter-spacing: 0.12em;
      font-weight: 700;
      text-shadow: 0 0 16px #fff, 0 0 32px #b71c1c;
    }

    .slot-arch-emoji {
      font-size: 4rem;
      margin-top: -1.5rem;
    }

    /* Add little stickers all over the base for a playful, high-quality look */
    .slot-base-sticker.little {
      width: 1.7rem;
      height: 1.7rem;
      min-width: 1.7rem;
      min-height: 1.7rem;
      padding: 0.1rem;
      margin: 0 0.15rem;
      background: rgba(255,255,255,0.7);
      border-radius: 0.7rem;
      box-shadow: 0 1px 4px #0002, 0 0 0 1.5px #fff8 inset;
      border: 1.5px solid #e0e0e0;
      display: flex;
      align-items: center;
      justify-content: center;
      position: absolute;
      z-index: 3;
      transition: transform 0.12s;
    }
    .slot-base-sticker.little img {
      width: 1.2rem;
      height: 1.2rem;
      filter: drop-shadow(0 1px 2px #0003);
      margin: 0;
    }
    .slot-base-sticker.little:hover {
      transform: scale(1.2) rotate(-8deg);
      z-index: 10;
      box-shadow: 0 0 12px 2px #ffd70099, 0 2px 8px #0004;
    }

    /* Add little payout stickers for playful, high-quality look */
    .slot-payout-sticker {
      position: absolute;
      width: 2.1rem;
      height: 2.1rem;
      background: rgba(255,255,255,0.85);
      border-radius: 0.7rem;
      box-shadow: 0 1px 4px #0002, 0 0 0 1.5px #fff8 inset;
      border: 1.5px solid #e0e0e0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 10;
      padding: 0.1rem 0.2rem 0.2rem 0.2rem;
      font-size: 0.7rem;
      transition: transform 0.12s;
      cursor: pointer;
    }
    .slot-payout-sticker img {
      width: 1.3rem;
      height: 1.3rem;
      object-fit: contain;
      margin-bottom: 0.1rem;
      filter: drop-shadow(0 1px 2px #0003);
    }
    .slot-payout-sticker .payout {
      color: #b71c1c;
      font-weight: 700;
      text-shadow: 0 0 4px #fff, 0 0 8px #ffd700;
      font-size: 0.8rem;
      margin-top: -0.1rem;
    }
    .slot-payout-sticker .desc {
      color: #333;
      font-size: 0.6rem;
      font-weight: 500;
      opacity: 0.7;
      margin-bottom: 0.1rem;
      text-align: center;
    }
    .slot-payout-sticker.jackpot {
      border: 2px solid gold;
      box-shadow: 0 0 8px 1px gold, 0 1px 4px #0002;
      background: linear-gradient(180deg, #fffbe7 0%, #ffe082 100%);
    }
    .slot-payout-sticker:hover {
      transform: scale(1.18) rotate(-7deg);
      z-index: 20;
      box-shadow: 0 0 16px 2px #ffd70099, 0 2px 8px #0004;
    }

    /* Little payout stickers decorating the machine */
    .slot-payout-sticker.little {
      width: 1.7rem;
      height: 1.7rem;
      min-width: 1.7rem;
      min-height: 1.7rem;
      padding: 0.1rem;
      margin: 0 0.15rem;
      background: rgba(255,255,255,0.7);
      border-radius: 0.7rem;
      box-shadow: 0 1px 4px #0002, 0 0 0 1.5px #fff8 inset;
      border: 1.5px solid #e0e0e0;
      display: flex;
      align-items: center;
      justify-content: center;
      position: absolute;
      z-index: 3;
      transition: transform 0.12s;
    }
    .slot-payout-sticker.little img {
      width: 1.2rem;
      height: 1.2rem;
      filter: drop-shadow(0 1px 2px #0003);
      margin: 0;
    }
    .slot-payout-sticker.little:hover {
      transform: scale(1.2) rotate(-8deg);
      z-index: 10;
      box-shadow: 0 0 12px 2px #ffd70099, 0 2px 8px #0004;
    }

    .pay-table {
      margin: 1.2rem auto 0 auto;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      gap: 0.3rem;
      background: var(--paytable-bg);
      color: var(--paytable-color);
      box-shadow: 0 2px 8px #0002, 0 0 0 2px #fff8 inset;
      padding: 0.5rem 0.7rem;
      max-width: 98vw;
      font-size: 0.98rem;
      align-items: flex-start;
      width: 100%;
      min-width: 0;
    }
    .pay-row {
      display: flex;
      align-items: center;
      gap: 0.3rem;
      font-weight: 600;
      color: inherit;
      letter-spacing: 0.04em;
      margin: 0 0.1rem;
      flex-wrap: wrap;
    }
    .pay-symbol {
      width: 1.3rem;
      height: 1.3rem;
      object-fit: contain;
      filter: drop-shadow(0 1px 2px #0003);
      border-radius: 0.3rem;
      background: #fff;
      margin-right: 0.1rem;
      flex-shrink: 0;
    }
    .pay-label {
      color: inherit;
      font-size: 0.98rem;
      font-weight: 500;
      margin-right: 0.1rem;
      white-space: nowrap;
    }
    .pay-mult {
      color: #bfa100;
      font-size: 1rem;
      font-weight: 700;
      margin-left: 0.1rem;
      text-shadow: 0 0 4px #fff, 0 0 8px #ffd700;
      white-space: nowrap;
    }
    body:not(.light) .pay-mult {
      color: #e53935;
      text-shadow: 0 0 4px #fff, 0 0 8px #e53935;
    }
    @media (max-width: 600px) {
      .pay-table {
        padding: 0.4rem 0.2rem;
        font-size: 0.92rem;
      }
      .pay-symbol {
        width: 1.1rem;
        height: 1.1rem;
      }
      .pay-label, .pay-mult {
        font-size: 0.92rem;
      }
    }

    </style>
</head>
<body>
  <!-- Sound effects for spinning, stopping, and winning -->
  <audio id="spin-sound" src="sounds/spin.wav"></audio>
  <audio id="stop-sound" src="sounds/stop.wav"></audio>
  <audio id="win-sound" src="sounds/win.wav"></audio>
  <audio id="lose-sound" src="sounds/lose.wav"></audio>

  <!-- Button to toggle between light and dark mode -->
  <button class="toggle-mode" onclick="toggleMode()">Toggle Mode</button>

  <!-- Slot machine arch and frame -->
  <div class="slot-arch-frame">
    <div class="slot-arch-lights"></div>
    <div class="slot-arch-top">
      <div class="slot-arch-title-arc">
        <svg viewBox="0 0 700 120" width="100%" height="80" style="display:block;">
          <path id="arcPath" d="M 60 100 Q 350 10 640 100" fill="transparent" stroke="none"/>
          <text width="100%">
            <textPath href="#arcPath" startOffset="50%" text-anchor="middle" dominant-baseline="middle" style="font-size:2.8rem;fill:#fff;stroke:#b71c1c;stroke-width:2;letter-spacing:0.12em;font-weight:700;text-shadow:0 0 16px #fff,0 0 32px #b71c1c;">
              OctoSlots
            </textPath>
          </text>
        </svg>
        <div class="slot-arch-emoji" style="margin-bottom:0.2rem;">🎰</div>
      </div>
    </div>
    <div class="container">
      <!-- Win line and banner, shown when you win -->
      <div class="reels" style="position: relative;">
        <div class="win-line" id="win-line"></div>
        <div class="reel" id="reel1"><div class="reel-strip"></div></div>
        <div class="reel" id="reel2"><div class="reel-strip"></div></div>
        <div class="reel" id="reel3"><div class="reel-strip"></div></div>
      </div>
      <div class="slot-arch-lights slot-arch-lights-bottom"></div>
      <div class="win-banner" id="win-banner">🎉 WINNER! 🎉</div>
      <!-- Spin button -->
      <div class="controls">
        <button class="spin" id="spin-btn" onclick="spin()">SPIN</button>
      </div>
      <!-- Player credits and last win display -->
      <div class="jackpot">
        Credits: <span id="credits">1000</span> &nbsp;|&nbsp; Last Win: <span id="last-win">0</span>
        <span id="last-win-symbols" style="display:inline-block; vertical-align:middle; margin-left:10px;"></span>
      </div>
      <!-- Pay table below credits/last win -->
      <div class="pay-table">
        <div class="pay-row">
          <img src="images/original.png" alt="Original Octocat" class="pay-symbol" />
          <span class="pay-label">3 Originals (JACKPOT)</span>
          <span class="pay-mult">x100</span>
        </div>
        <div class="pay-row">
          <img src="images/daftpunktocat-guy.gif" alt="Daftpunktocat" class="pay-symbol" />
          <span class="pay-label">3 Daftpunktocat</span>
          <span class="pay-mult">x50</span>
        </div>
        <div class="pay-row">
          <img src="images/surftocat.png" alt="Other Octocats" class="pay-symbol" />
          <span class="pay-label">3 of any other</span>
          <span class="pay-mult">x10</span>
        </div>
        <div class="pay-row">
          <img src="images/original.png" alt="Any Octocat" class="pay-symbol" />
          <span class="pay-label">2 of any</span>
          <span class="pay-mult">x5</span>
        </div>
      </div>
    </div>
    <div class="slot-base">
      <!-- Only payout stickers, no extra Octocat heads -->
    </div>
  </div>

  <!-- Main game logic -->
  <script>
    // List of symbol image URLs for the reels
    const symbols = [
      'https://bensbar.github.io/OctoSlots/images/original.png',
      'https://bensbar.github.io/OctoSlots/images/surftocat.png',
      'https://bensbar.github.io/OctoSlots/images/daftpunktocat-guy.gif',
      'https://bensbar.github.io/OctoSlots/images/dinotocat.png',
      'https://bensbar.github.io/OctoSlots/images/securitocat.png',
      'https://bensbar.github.io/OctoSlots/images/yogitocat.png',
      'https://bensbar.github.io/OctoSlots/images/ironcat.png',
      'https://bensbar.github.io/OctoSlots/images/spidertocat.png',
      'https://bensbar.github.io/OctoSlots/images/repo.png',
      'https://bensbar.github.io/OctoSlots/images/minion.png',
      'https://bensbar.github.io/OctoSlots/images/plumber.png',
      'https://bensbar.github.io/OctoSlots/images/megacat.',
      'https://bensbar.github.io/OctoSlots/images/vinyltocat.png'
    ];

    // Get audio elements for sound effects
    const spinSound = document.getElementById('spin-sound');
    const stopSound = document.getElementById('stop-sound');
    const winSound = document.getElementById('win-sound');

    // Fill a reel with random symbols. Optionally, stop at a specific symbol index.
    function fillReel(reel, stopAt = null) {
      const strip = reel.querySelector('.reel-strip');
      strip.innerHTML = '';
      // Add 20 random symbols to the reel
      for (let i = 0; i < 20; i++) {
        const sym = document.createElement('div');
        sym.className = 'symbol';
        const img = document.createElement('img');
        // Pick a random symbol from the list
        const symbol = symbols[Math.floor(Math.random() * symbols.length)];
        img.src = symbol;
        sym.appendChild(img);
        strip.appendChild(sym);
      }

      // If a stop position is given, set the strip position so the chosen symbol is centered
      if (stopAt !== null) {
        // Center the symbol in the viewing window (same logic as animateToStop)  
        const centeredPosition = stopAt * 112 - 88;
        strip.style.transform = `translateY(${-centeredPosition}px)`;
      }
    }

    // Animate a reel spinning and stopping at a specific symbol
    function animateReel(reel, spinTime, stopAt) {
      // This function spins the reel for spinTime ms, then animates to stopAt (always forward)
      return new Promise(resolve => {
        const strip = reel.querySelector('.reel-strip');
        let spinning = true;
        let startTime = null;
        let lastY = 0;
        let frame;
        const totalSymbols = 20;
        const symbolHeight = 112; // Match CSS --symbol-size: 7rem (7 * 16px = 112px)
        // Looping spin
        function spinLoop(ts) {
          if (!startTime) startTime = ts;
          const elapsed = ts - startTime;
          if (elapsed < spinTime) {
            lastY = (elapsed * 2) % (totalSymbols * symbolHeight); // 2px/ms speed, 20 symbols
            strip.style.transform = `translateY(${-lastY}px)`;
            frame = requestAnimationFrame(spinLoop);
          } else {
            spinning = false;
            // Use the current modulo position as the start for the stop animation
            let modY = ((lastY % (totalSymbols * symbolHeight)) + (totalSymbols * symbolHeight)) % (totalSymbols * symbolHeight);
            // Animate to stopAt (always forward)
            animateToStop(modY, stopAt);
          }
        }
        // Animate from current position to stopAt (always forward)
        function animateToStop(currentModY, stopAt) {
          // Center the symbol in the viewing window
          // Viewing window height ≈ 288px, symbol height = 112px
          // To center: symbol top should be at (288/2 - 112/2) = 88px from viewing window top
          const targetY = stopAt * symbolHeight - 88;
          // Always move forward to the next occurrence of stopAt
          let forwardDistance = (targetY - currentModY + totalSymbols * symbolHeight) % (totalSymbols * symbolHeight);
          const duration = 600;
          let animStart = null;
          function animStep(ts) {
            if (!animStart) animStart = ts;
            const progress = Math.min((ts - animStart) / duration, 1);
            const y = currentModY + progress * forwardDistance;
            // Always keep the strip in visible range
            const modY = ((y % (totalSymbols * symbolHeight)) + (totalSymbols * symbolHeight)) % (totalSymbols * symbolHeight);
            strip.style.transform = `translateY(${-modY}px)`;
            if (progress < 1) {
              requestAnimationFrame(animStep);
            } else {
              strip.style.transform = `translateY(${-targetY}px)`;
              stopSound.play();
              resolve();
            }
          }
          requestAnimationFrame(animStep);
        }
        requestAnimationFrame(spinLoop);
      });
    }

    // Show sparkles on win
    function sparkleEffect() {
      // Create 15 sparkles at random positions
      for (let i = 0; i < 15; i++) {
        const s = document.createElement('div');
        s.className = 'sparkle';
        s.style.left = `${Math.random() * window.innerWidth}px`;
        s.style.top = `${Math.random() * 400 + 100}px`;
        document.body.appendChild(s);
        // Remove the sparkle after 1 second
        setTimeout(() => s.remove(), 1000);
      }
    }

    // Main function to spin the reels
    // Track player credits and last win
    let credits = 1000;
    let lastWin = 0;
    const betAmount = 100;

    // Flashing lights animation
    let lightInterval = null;
    function startLights(winning = false) {
      if (lightInterval) clearInterval(lightInterval);
      
      const lights = document.querySelectorAll('.slot-arch-light');
      lights.forEach(light => light.classList.remove('on'));
      
      let idx = 0;
      lightInterval = setInterval(() => {
        lights.forEach((light, i) => {
          if (winning) {
            // Random flashing for winning
            light.classList.toggle('on', Math.random() > 0.5);
          } else {
            // Sequential flashing for spinning
            light.classList.toggle('on', i === idx % lights.length);
          }
        });
        idx++;
      }, 100);
    }
    
    function stopLights() {
      if (lightInterval) clearInterval(lightInterval);
      const lights = document.querySelectorAll('.slot-arch-light');
      lights.forEach(light => light.classList.remove('on'));
    }

    function updateDisplay() {
      document.getElementById('credits').textContent = credits;
      document.getElementById('last-win').textContent = lastWin;
    }

    async function spin() {
      // Hide win popup if visible
      document.getElementById('win-banner').style.display = 'none';
      
      // Stop any previous light effects
      stopLights();

      // Prevent spinning if not enough credits
      if (credits < betAmount) {
        alert('Not enough credits!');
        return;
      }
      // Disable spin button during spin
      document.getElementById('spin-btn').disabled = true;

      // Start flashing lights to indicate spinning
      startLights();

      // Deduct bet
      credits -= betAmount;
      updateDisplay();

      // Play the spin sound
      spinSound.play();

      // Get all three reels
      const reels = [document.getElementById('reel1'), document.getElementById('reel2'), document.getElementById('reel3')];
      // Pick a random stop position for each reel (symbol indices 0-19)
      const stops = reels.map(() => Math.floor(Math.random() * 20));
      // Fill each reel with random symbols
      reels.forEach((reel, index) => fillReel(reel)); // preload strips

      // Start all reels spinning at the same time, but stop them individually
      const spinTimes = [1800, 2300, 2800];
      const reelPromises = reels.map((reel, i) => animateReel(reel, spinTimes[i], stops[i]));
      // Wait for each reel to finish in order (but all started together)
      for (let i = 0; i < reelPromises.length; i++) {
        await reelPromises[i];
      }

      // Stop the spin sound
      spinSound.pause();
      spinSound.currentTime = 0;

      // Re-enable spin button immediately after reels stop - allows immediate next spin
      document.getElementById('spin-btn').disabled = false;

      // Win logic: all three reels stop at the same position
      let win = false;
      // --- WIN LOGIC ---
      // Only consider the center row (middle symbol) of each reel
      // Get the center index for each reel
      const reelsArr = [document.getElementById('reel1'), document.getElementById('reel2'), document.getElementById('reel3')];
      const totalSymbols = 20;
      const symbolHeight = 112; // Match CSS --symbol-size: 7rem (7 * 16px = 112px)
      function getCenterSymbolSrc(reel) {
        const reelRect = reel.getBoundingClientRect();
        const centerY = reelRect.top + reelRect.height / 2;
        const symbols = Array.from(reel.querySelectorAll('.symbol'));
        for (let symbolDiv of symbols) {
          const rect = symbolDiv.getBoundingClientRect();
          if (rect.top <= centerY && rect.bottom >= centerY) {
            const img = symbolDiv.querySelector('img');
            return img ? img.src : '';
          }
        }
        return '';
      }
      // Get the three center symbols by DOM position
      const symbolsLanded = reelsArr.map(reel => getCenterSymbolSrc(reel));
      // Count occurrences of each symbol in the center row
      const counts = {};
      symbolsLanded.forEach(src => { counts[src] = (counts[src] || 0) + 1; });
      let winType = null;
      let winSymbol = null;
      let payout = 0;
      let jackpotSymbols = [
        'https://bensbar.github.io/OctoSlots/images/daftpunktocat-guy.gif',
        'https://bensbar.github.io/OctoSlots/images/original.png'
      ];
      // Find the actual max count and its symbol
      let maxCount = 0;
      let maxSymbol = null;
      for (let src in counts) {
        if (counts[src] > maxCount) {
          maxCount = counts[src];
          maxSymbol = src;
        }
      }
      // Check for 3 of a kind (jackpot or normal)
      if (maxCount === 3) {
        winType = jackpotSymbols.includes(maxSymbol) ? 'jackpot' : 'three';
        winSymbol = maxSymbol;
      } else if (maxCount === 2) {
        winType = 'two';
        winSymbol = maxSymbol;
      }
      // Set payout
      if (winType === 'jackpot') {
        payout = 100 * betAmount;
      } else if (winType === 'three') {
        payout = 10 * betAmount;
      } else if (winType === 'two') {
        payout = 2 * betAmount;
      }

      // Show win if any
      const lastWinSymbols = document.getElementById('last-win-symbols');
      lastWinSymbols.innerHTML = '';
      if (winType) {
        lastWin = payout;
        credits += lastWin;
        updateDisplay();
        // Show small octocats for the win
        for (let i = 0; i < 3; i++) {
          if (symbolsLanded[i] === winSymbol) {
            const img = document.createElement('img');
            img.src = winSymbol;
            img.style.width = '32px';
            img.style.height = '32px';
            img.style.margin = '0 2px';
            img.style.verticalAlign = 'middle';
            lastWinSymbols.appendChild(img);
          }
        }
        const winBanner = document.getElementById('win-banner');
        winBanner.textContent = winType === 'jackpot' ? '🎉 JACKPOT! 🎉' : (winType === 'three' ? '🎉 BIG WIN! 🎉' : 'WIN!');
        winBanner.style.display = 'block';
        winSound.play();
        sparkleEffect();
        // Start winning lights animation
        startLights(true);
        setTimeout(() => {
          winBanner.style.display = 'none';
        }, 2000);
      } else {
        lastWin = 0;
        updateDisplay();
        lastWinSymbols.innerHTML = '';
        // Play lose sound
        const loseSound = document.getElementById('lose-sound');
        if (loseSound) {
          loseSound.currentTime = 0;
          loseSound.play();
        }
        // Stop lights on lose
        stopLights();
      }
    }

    // Toggle between light and dark mode
    function toggleMode() {
      document.body.classList.toggle('light');
    }

    // Hide win popup when clicking spin or the popup itself
    document.addEventListener('DOMContentLoaded', () => {
      const winBanner = document.getElementById('win-banner');
      winBanner.addEventListener('click', () => {
        winBanner.style.display = 'none';
      });
      document.getElementById('spin-btn').addEventListener('click', () => {
        winBanner.style.display = 'none';
      });
    });

    // When the page loads, fill each reel with random symbols and update display
    window.onload = () => {
      fillReel(document.getElementById('reel1'), Math.floor(Math.random() * 20));
      fillReel(document.getElementById('reel2'), Math.floor(Math.random() * 20));
      fillReel(document.getElementById('reel3'), Math.floor(Math.random() * 20));
      updateDisplay();
      // Add slot machine handle
      const handle = document.createElement('div');
      handle.className = 'slot-handle';
      const knob = document.createElement('div');
      knob.className = 'slot-handle-knob';
      handle.appendChild(knob);
      document.querySelector('.reels').appendChild(handle);

      // Handle lever pull interaction
      let pulling = false;
      knob.addEventListener('mousedown', () => {
        if (pulling) return;
        pulling = true;
        handle.classList.add('pulled');
      });
      document.addEventListener('mouseup', () => {
        if (!pulling) return;
        handle.classList.remove('pulled');
        setTimeout(() => {
          document.getElementById('spin-btn').click();
          pulling = false;
        }, 150); // short delay for lever animation
      });

      // Add blinky lights to the arch (top and bottom)
      function addArchLights(selector, count) {
        const lightsContainer = document.querySelector(selector);
        if (lightsContainer) {
          lightsContainer.innerHTML = '';
          for (let i = 0; i < count; i++) {
            const light = document.createElement('div');
            light.className = 'slot-arch-light';
            lightsContainer.appendChild(light);
          }
        }
      }
      document.addEventListener('DOMContentLoaded', () => {
        addArchLights('.slot-arch-lights', 22);
        addArchLights('.slot-arch-lights-bottom', 18);
      });
    };
  </script>

</body></html>