<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="NFL Slots 4K">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#013369">
  <title>NFL Championship Slots - 4K Ultra HD</title>
  <style>
    :root {
      /* NFL Ultra High-Res Colors */
      --nfl-blue: #013369;
      --nfl-red: #D50A0A;
      --nfl-silver: #A5ACAF;
      --nfl-gold: #FFB612;
      --nfl-dark-gold: #CC9100;
      --primary-bg: linear-gradient(135deg, #000000 0%, #0f1419 25%, #1a1a2e 50%, #16213e 75%, #13264a 100%);
      --machine-body: linear-gradient(145deg, #2d3748 0%, #374151 25%, #1f2937 50%, #111827 75%, #0f172a 100%);
      --text-shadow: 0 0 10px rgba(255, 182, 18, 0.8), 0 0 20px rgba(255, 182, 18, 0.6), 0 0 30px rgba(255, 182, 18, 0.4);
      --machine-glow: 0 0 60px rgba(255, 182, 18, 0.4), 0 0 120px rgba(255, 182, 18, 0.2), inset 0 0 40px rgba(0, 0, 0, 0.6);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Arial Black', 'Helvetica', Arial, sans-serif;
      background: var(--primary-bg);
      color: #FFFFFF;
      overflow: hidden;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      image-rendering: -webkit-optimize-contrast;
      image-rendering: crisp-edges;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .game-container {
      width: 100%;
      max-width: 1400px;
      height: 100vh;
      max-height: 1200px;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
    }

    .slot-machine {
      width: 100%;
      max-width: 1200px;
      background: var(--machine-body);
      border: 12px solid var(--nfl-silver);
      border-top: none;
      border-radius: 0 0 40px 40px;
      padding: 50px;
      box-shadow: var(--machine-glow);
      position: relative;
      backdrop-filter: blur(20px);
      animation: machineGlow 4s ease-in-out infinite alternate;
      transform: perspective(1000px) rotateX(2deg);
    }

    @keyframes machineGlow {
      0% { 
        box-shadow: 0 0 60px rgba(255, 182, 18, 0.3), 0 0 120px rgba(255, 182, 18, 0.1), inset 0 0 40px rgba(0, 0, 0, 0.6);
        filter: brightness(1);
      }
      100% { 
        box-shadow: 0 0 100px rgba(255, 182, 18, 0.5), 0 0 200px rgba(255, 182, 18, 0.2), inset 0 0 40px rgba(0, 0, 0, 0.6);
        filter: brightness(1.05);
      }
    }

    .machine-header {
      text-align: center;
      margin-bottom: 40px;
      position: relative;
      margin-top: -20px;
    }

    .nfl-logo {
      width: 180px;
      height: 120px;
      margin-bottom: 20px;
      background: linear-gradient(45deg, #FFB612, #FFD700);
      border: 4px solid #013369;
      border-radius: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
      font-weight: 900;
      color: #013369;
      text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.3);
      filter: drop-shadow(0 0 30px rgba(255, 182, 18, 1)) drop-shadow(0 0 60px rgba(255, 182, 18, 0.6));
      animation: logoFloat 3s ease-in-out infinite alternate;
      position: relative;
      z-index: 10;
      margin: -40px auto 20px;
    }

    @keyframes logoFloat {
      0% { transform: translateY(0px) scale(1); }
      100% { transform: translateY(-8px) scale(1.02); }
    }

    .machine-title {
      font-size: clamp(32px, 5vw, 64px);
      font-weight: 900;
      color: var(--nfl-gold);
      text-shadow: var(--text-shadow);
      margin-bottom: 15px;
      letter-spacing: 3px;
      background: linear-gradient(45deg, #FFB612, #FFC942, #FFB612);
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: titleShimmer 3s ease-in-out infinite;
    }

    @keyframes titleShimmer {
      0%, 100% { filter: brightness(1) saturate(1); }
      50% { filter: brightness(1.2) saturate(1.3); }
    }

    .jackpot-display {
      font-size: clamp(20px, 3vw, 36px);
      font-weight: bold;
      color: var(--nfl-gold);
      text-shadow: var(--text-shadow);
      background: linear-gradient(45deg, rgba(0, 0, 0, 0.9), rgba(30, 30, 60, 0.9), rgba(0, 0, 0, 0.9));
      padding: 20px 40px;
      border-radius: 25px;
      border: 4px solid var(--nfl-gold);
      box-shadow: 0 0 30px rgba(255, 182, 18, 0.6), inset 0 0 20px rgba(0, 0, 0, 0.5);
      animation: jackpotPulse 2.5s ease-in-out infinite;
    }

    @keyframes jackpotPulse {
      0%, 100% { 
        transform: scale(1);
        box-shadow: 0 0 30px rgba(255, 182, 18, 0.6), inset 0 0 20px rgba(0, 0, 0, 0.5);
      }
      50% { 
        transform: scale(1.03);
        box-shadow: 0 0 50px rgba(255, 182, 18, 0.8), inset 0 0 20px rgba(0, 0, 0, 0.5);
      }
    }

    .led-lights {
      position: absolute;
      top: -20px;
      left: 30px;
      right: 30px;
      height: 40px;
      display: flex;
      justify-content: space-around;
      align-items: center;
      z-index: 10;
    }

    .led-light {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #555, #333, #111);
      border: 3px solid var(--nfl-silver);
      box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.8), 0 0 10px rgba(0, 0, 0, 0.5);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .led-light::before {
      content: '';
      position: absolute;
      top: 20%;
      left: 20%;
      width: 40%;
      height: 40%;
      background: radial-gradient(circle, rgba(255, 255, 255, 0.8), transparent);
      border-radius: 50%;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .led-light.on {
      background: radial-gradient(circle at 30% 30%, #ff4444, #cc0000, #880000);
      box-shadow: 
        0 0 30px #ff4444,
        0 0 60px #ff4444,
        0 0 90px rgba(255, 68, 68, 0.5),
        inset 0 0 15px rgba(255, 255, 255, 0.2);
    }

    .led-light.on::before { opacity: 1; }

    .led-light:nth-child(2n).on {
      background: radial-gradient(circle at 30% 30%, #4488ff, #0066cc, #004488);
      box-shadow: 
        0 0 30px #4488ff,
        0 0 60px #4488ff,
        0 0 90px rgba(68, 136, 255, 0.5),
        inset 0 0 15px rgba(255, 255, 255, 0.2);
    }

    .led-light:nth-child(3n).on {
      background: radial-gradient(circle at 30% 30%, #44ff44, #00cc00, #008800);
      box-shadow: 
        0 0 30px #44ff44,
        0 0 60px #44ff44,
        0 0 90px rgba(68, 255, 68, 0.5),
        inset 0 0 15px rgba(255, 255, 255, 0.2);
    }

    .led-light.win {
      background: radial-gradient(circle at 30% 30%, var(--nfl-gold), var(--nfl-dark-gold), #996600);
      box-shadow: 
        0 0 40px var(--nfl-gold),
        0 0 80px var(--nfl-gold),
        0 0 120px rgba(255, 182, 18, 0.6),
        inset 0 0 20px rgba(255, 255, 255, 0.3);
      animation: winLightPulse 0.2s ease-in-out infinite alternate;
    }

    @keyframes winLightPulse {
      0% { opacity: 0.7; transform: scale(1); }
      100% { opacity: 1; transform: scale(1.05); }
    }

    .reels-container {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 30px;
      margin: 40px 0;
      padding: 40px;
      background: linear-gradient(145deg, #000000, #1a1a2e, #000000);
      border: 8px solid var(--nfl-silver);
      border-radius: 30px;
      box-shadow: 
        inset 0 0 50px rgba(0, 0, 0, 0.9),
        0 0 30px rgba(255, 182, 18, 0.3),
        0 20px 40px rgba(0, 0, 0, 0.6);
      position: relative;
      overflow: hidden;
    }

    .reels-container::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent, rgba(255, 182, 18, 0.03), transparent);
      animation: shimmer 4s linear infinite;
      pointer-events: none;
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
      100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
    }

    .reel {
      height: 360px;
      background: linear-gradient(180deg, #1a1a2e 0%, #000000 25%, #0a0a0a 50%, #000000 75%, #1a1a2e 100%);
      border: 6px solid var(--nfl-silver);
      border-radius: 20px;
      overflow: hidden;
      position: relative;
      box-shadow: 
        inset 0 0 30px rgba(0, 0, 0, 0.9),
        0 0 20px rgba(255, 182, 18, 0.2),
        0 10px 20px rgba(0, 0, 0, 0.8);
    }

    .reel::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 80px;
      background: linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent);
      z-index: 5;
      pointer-events: none;
    }

    .reel::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 80px;
      background: linear-gradient(to top, rgba(0, 0, 0, 0.8), transparent);
      z-index: 5;
      pointer-events: none;
    }

    /* OPTIMIZED: Hardware-accelerated symbol track */
    .symbol-track {
      display: flex;
      flex-direction: column;
      height: 100%;
      justify-content: space-around;
      align-items: center;
      padding: 0;
      position: relative;
      will-change: transform;
      backface-visibility: hidden;
      transform: translateZ(0);
    }

    /* OPTIMIZED: Smooth GPU-accelerated spinning */
    .symbol-track.spinning {
      animation: reelSpinUltraSmooth 0.08s linear infinite;
    }

    .symbol-track.decelerating {
      animation: reelDecelerate 2s cubic-bezier(0.23, 1, 0.320, 1) forwards;
    }

    /* OPTIMIZED: Ultra-smooth spinning with GPU acceleration */
    @keyframes reelSpinUltraSmooth {
      0% { transform: translateY(0) translateZ(0); }
      100% { transform: translateY(-120px) translateZ(0); }
    }

    @keyframes reelDecelerate {
      0% { 
        transform: translateY(-120px) translateZ(0);
        animation-timing-function: cubic-bezier(0.23, 1, 0.320, 1);
      }
      100% { 
        transform: translateY(0) translateZ(0);
      }
    }

    /* Team symbol styling */
    .team-symbol {
      width: 120px;
      height: 120px;
      border-radius: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      font-weight: 900;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
      border: 3px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.6);
      margin: 0;
      flex-shrink: 0;
      will-change: transform;
      backface-visibility: hidden;
      transform: translateZ(0);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .team-symbol:hover {
      transform: scale(1.02) translateZ(0);
    }

    .team-symbol.win {
      transform: scale(1.15) translateZ(0);
      filter: 
        drop-shadow(0 0 25px rgba(255, 182, 18, 1))
        drop-shadow(0 0 50px rgba(255, 182, 18, 0.8))
        drop-shadow(0 0 75px rgba(255, 182, 18, 0.6));
      animation: winGlowUltra 1.2s ease-in-out infinite alternate;
      z-index: 10;
      position: relative;
    }

    @keyframes winGlowUltra {
      0% { 
        filter: drop-shadow(0 0 25px rgba(255, 182, 18, 1)) drop-shadow(0 0 50px rgba(255, 182, 18, 0.8));
        transform: scale(1.15) translateZ(0);
      }
      100% { 
        filter: drop-shadow(0 0 40px rgba(255, 182, 18, 1)) drop-shadow(0 0 80px rgba(255, 182, 18, 1)) drop-shadow(0 0 120px rgba(255, 182, 18, 0.8));
        transform: scale(1.2) translateZ(0);
      }
    }

    /* Team-specific colors */
    .team-nfl { background: linear-gradient(45deg, #FFB612, #FFC942); color: #013369; }
    .team-trophy { background: linear-gradient(45deg, #FFD700, #FFC107); color: #000; }
    .team-afc { background: linear-gradient(45deg, #FF0000, #E31837); color: #FFF; }
    .team-nfc { background: linear-gradient(45deg, #0000FF, #1e40af); color: #FFF; }
    .team-chiefs { background: linear-gradient(45deg, #E31837, #B01426); color: #FFF; }
    .team-patriots { background: linear-gradient(45deg, #002244, #001633); color: #FFF; }
    .team-packers { background: linear-gradient(45deg, #203731, #142920); color: #FFB612; }
    .team-cowboys { background: linear-gradient(45deg, #041E42, #031531); color: #FFF; }
    .team-steelers { background: linear-gradient(45deg, #000, #333); color: #FFB612; }
    .team-49ers { background: linear-gradient(45deg, #AA0000, #880000); color: #FFF; }
    .team-eagles { background: linear-gradient(45deg, #004C54, #003943); color: #FFF; }
    .team-falcons { background: linear-gradient(45deg, #A71930, #871326); color: #FFF; }

    .payline {
      position: absolute;
      width: 100%;
      height: 6px;
      background: transparent;
      z-index: 15;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius: 3px;
    }

    .payline.active {
      background: linear-gradient(90deg, 
        transparent 0%, 
        rgba(255, 182, 18, 0.8) 5%,
        var(--nfl-gold) 15%, 
        var(--nfl-gold) 85%, 
        rgba(255, 182, 18, 0.8) 95%,
        transparent 100%);
      box-shadow: 
        0 0 30px var(--nfl-gold),
        0 0 60px rgba(255, 182, 18, 0.6),
        inset 0 0 10px rgba(255, 255, 255, 0.3);
      animation: paylineGlowUltra 1.5s ease-in-out infinite alternate;
    }

    @keyframes paylineGlowUltra {
      0% { 
        opacity: 0.8; 
        transform: scaleY(1);
        box-shadow: 0 0 30px var(--nfl-gold), 0 0 60px rgba(255, 182, 18, 0.6);
      }
      100% { 
        opacity: 1; 
        transform: scaleY(1.2);
        box-shadow: 0 0 50px var(--nfl-gold), 0 0 100px rgba(255, 182, 18, 0.8);
      }
    }

    .payline.line-1 { top: 25%; }
    .payline.line-2 { top: 50%; }
    .payline.line-3 { top: 75%; }

    .controls-section {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      gap: 30px;
      align-items: center;
      margin-top: 40px;
    }

    .info-displays {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
    }

    .info-card {
      background: linear-gradient(145deg, #1f2937, #374151, #1f2937);
      border: 4px solid var(--nfl-silver);
      border-radius: 20px;
      padding: 25px;
      text-align: center;
      box-shadow: 
        inset 0 0 25px rgba(0, 0, 0, 0.6),
        0 0 20px rgba(255, 182, 18, 0.3),
        0 8px 16px rgba(0, 0, 0, 0.4);
      transition: all 0.3s ease;
    }

    .info-card:hover {
      transform: translateY(-3px);
      box-shadow: 
        inset 0 0 25px rgba(0, 0, 0, 0.6),
        0 0 30px rgba(255, 182, 18, 0.4),
        0 12px 24px rgba(0, 0, 0, 0.5);
    }

    .info-label {
      font-size: 18px;
      font-weight: bold;
      color: var(--nfl-silver);
      margin-bottom: 8px;
      letter-spacing: 2px;
      text-shadow: 0 0 5px rgba(0, 0, 0, 0.8);
    }

    .info-value {
      font-size: clamp(24px, 4vw, 36px);
      font-weight: 900;
      color: var(--nfl-gold);
      text-shadow: var(--text-shadow);
      background: linear-gradient(45deg, #FFB612, #FFC942);
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .spin-button {
      width: 160px;
      height: 160px;
      border-radius: 50%;
      background: linear-gradient(145deg, var(--nfl-red), #dc2626, var(--nfl-red));
      border: 8px solid var(--nfl-gold);
      color: white;
      font-size: 24px;
      font-weight: 900;
      letter-spacing: 2px;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 
        0 0 40px rgba(213, 10, 10, 0.6),
        inset 0 0 30px rgba(255, 255, 255, 0.1),
        0 12px 24px rgba(0, 0, 0, 0.5);
      position: relative;
      overflow: hidden;
      text-shadow: 0 0 10px rgba(0, 0, 0, 0.8);
    }

    .spin-button::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      transform: rotate(45deg);
      transition: all 0.6s ease;
    }

    .spin-button:hover {
      transform: translateY(-5px) scale(1.02);
      box-shadow: 
        0 0 60px rgba(213, 10, 10, 0.8),
        inset 0 0 30px rgba(255, 255, 255, 0.2),
        0 20px 40px rgba(0, 0, 0, 0.6);
    }

    .spin-button:hover::before {
      transform: rotate(45deg) translate(50%, 50%);
    }

    .spin-button:active {
      transform: translateY(-2px) scale(0.98);
      box-shadow: 
        0 0 30px rgba(213, 10, 10, 0.6),
        inset 0 0 30px rgba(0, 0, 0, 0.3),
        0 8px 16px rgba(0, 0, 0, 0.6);
    }

    .spin-button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .betting-controls {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      justify-self: end;
    }

    .bet-button {
      padding: 18px 30px;
      background: linear-gradient(145deg, var(--nfl-blue), #1e40af, var(--nfl-blue));
      border: 4px solid var(--nfl-silver);
      border-radius: 15px;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      font-size: 16px;
      text-transform: uppercase;
      letter-spacing: 1px;
      text-shadow: 0 0 5px rgba(0, 0, 0, 0.8);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }

    .bet-button:hover {
      background: linear-gradient(145deg, #1e40af, var(--nfl-blue), #1e40af);
      transform: translateY(-3px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
    }

    .bet-button.active {
      background: linear-gradient(145deg, var(--nfl-gold), #f59e0b, var(--nfl-gold));
      color: #000;
      text-shadow: 0 0 5px rgba(255, 255, 255, 0.8);
    }

    .game-controls {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 30px;
      flex-wrap: wrap;
    }

    .control-button {
      padding: 18px 36px;
      background: linear-gradient(145deg, #374151, #1f2937, #374151);
      border: 4px solid var(--nfl-silver);
      border-radius: 15px;
      color: var(--nfl-gold);
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      font-size: 16px;
      text-transform: uppercase;
      letter-spacing: 1px;
      text-shadow: 0 0 5px rgba(0, 0, 0, 0.8);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }

    .control-button:hover {
      background: linear-gradient(145deg, var(--nfl-gold), #f59e0b, var(--nfl-gold));
      color: #000;
      transform: translateY(-3px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
      text-shadow: 0 0 5px rgba(255, 255, 255, 0.8);
    }

    .win-overlay {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      background: linear-gradient(145deg, rgba(0, 0, 0, 0.95), rgba(30, 30, 60, 0.95), rgba(0, 0, 0, 0.95));
      border: 8px solid var(--nfl-gold);
      border-radius: 30px;
      padding: 60px;
      text-align: center;
      z-index: 2000;
      backdrop-filter: blur(30px);
      box-shadow: 
        0 0 80px rgba(255, 182, 18, 1),
        inset 0 0 40px rgba(0, 0, 0, 0.6),
        0 20px 40px rgba(0, 0, 0, 0.8);
      transition: all 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }

    .win-overlay.visible {
      transform: translate(-50%, -50%) scale(1);
    }

    .win-overlay .win-text {
      font-size: clamp(32px, 6vw, 72px);
      font-weight: 900;
      background: linear-gradient(45deg, #FFB612, #FFC942, #FFD700, #FFC942, #FFB612);
      background-size: 300% 300%;
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 30px;
      animation: winTextShimmer 2s ease-in-out infinite, winTextGlow 1.5s ease-in-out infinite alternate;
    }

    @keyframes winTextShimmer {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    @keyframes winTextGlow {
      0% { 
        filter: brightness(1) saturate(1);
        transform: scale(1);
      }
      100% { 
        filter: brightness(1.3) saturate(1.5);
        transform: scale(1.02);
      }
    }

    .win-overlay .win-amount {
      font-size: clamp(24px, 5vw, 48px);
      font-weight: bold;
      color: #10B981;
      text-shadow: 0 0 20px rgba(16, 185, 129, 0.8), 0 0 40px rgba(16, 185, 129, 0.6);
    }

    .paytable {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 90%;
      max-width: 600px;
      max-height: 85vh;
      background: linear-gradient(145deg, #1f2937, #111827, #1f2937);
      border: 8px solid var(--nfl-gold);
      border-radius: 30px;
      padding: 40px;
      color: white;
      z-index: 3000;
      display: none;
      overflow-y: auto;
      box-shadow: 
        0 0 80px rgba(255, 182, 18, 0.6),
        inset 0 0 40px rgba(0, 0, 0, 0.6),
        0 20px 40px rgba(0, 0, 0, 0.8);
    }

    .paytable.visible {
      display: block;
      animation: paytableSlideIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }

    @keyframes paytableSlideIn {
      0% { transform: translate(-50%, -50%) scale(0.8) rotateY(-10deg); opacity: 0; }
      100% { transform: translate(-50%, -50%) scale(1) rotateY(0deg); opacity: 1; }
    }

    .paytable-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.8);
      z-index: 2999;
      display: none;
      backdrop-filter: blur(15px);
    }

    .paytable-overlay.visible {
      display: block;
    }

    .paytable-title {
      text-align: center;
      font-size: 36px;
      font-weight: 900;
      background: linear-gradient(45deg, #FFB612, #FFC942);
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 30px;
      text-shadow: 0 0 20px rgba(255, 182, 18, 0.6);
    }

    .paytable-section {
      margin-bottom: 30px;
    }

    .paytable-section h3 {
      font-size: 24px;
      color: var(--nfl-silver);
      margin-bottom: 20px;
      border-bottom: 3px solid var(--nfl-gold);
      padding-bottom: 8px;
      text-shadow: 0 0 10px rgba(0, 0, 0, 0.8);
    }

    .payout-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 15px;
      margin-bottom: 12px;
      background: rgba(255, 255, 255, 0.08);
      border-radius: 15px;
      border: 2px solid rgba(255, 182, 18, 0.3);
      transition: all 0.3s ease;
    }

    .payout-item:hover {
      background: rgba(255, 255, 255, 0.12);
      border-color: rgba(255, 182, 18, 0.5);
      transform: translateX(5px);
    }

    .payout-symbols {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .payout-value {
      font-weight: bold;
      font-size: 18px;
      color: var(--nfl-gold);
      text-shadow: 0 0 10px rgba(255, 182, 18, 0.6);
    }

    .paytable-close {
      position: absolute;
      top: 20px;
      right: 25px;
      background: var(--nfl-red);
      border: none;
      color: white;
      width: 45px;
      height: 45px;
      border-radius: 50%;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
    }

    .paytable-close:hover {
      background: #dc2626;
      transform: scale(1.1) rotate(90deg);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.5);
    }

    /* OPTIMIZED: Hardware-accelerated coin animation */
    .coin-animation {
      position: absolute;
      width: 40px;
      height: 40px;
      background: radial-gradient(circle at 30% 30%, var(--nfl-gold), #f59e0b, var(--nfl-dark-gold));
      border-radius: 50%;
      border: 3px solid #fff;
      box-shadow: 0 0 15px rgba(255, 182, 18, 0.8);
      animation: coinFallUltra 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
      z-index: 100;
      will-change: transform, opacity;
      backface-visibility: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 18px;
      color: #000;
    }

    @keyframes coinFallUltra {
      0% { 
        transform: translateY(0) rotate(0deg) scale(1) translateZ(0);
        opacity: 1;
      }
      50% {
        transform: translateY(100px) rotate(360deg) scale(1.2) translateZ(0);
        opacity: 1;
      }
      100% { 
        transform: translateY(300px) rotate(1080deg) scale(0.8) translateZ(0);
        opacity: 0;
      }
    }

    /* Enhanced Responsive Design for 4K */
    @media (max-width: 1920px) {
      .slot-machine {
        max-width: 1000px;
        padding: 40px;
      }
      
      .team-symbol {
        width: 100px;
        height: 100px;
        font-size: 24px;
      }
      
      .reel {
        height: 300px;
      }
    }

    @media (max-width: 1200px) {
      .slot-machine {
        max-width: 900px;
        padding: 35px;
      }
      
      .team-symbol {
        width: 90px;
        height: 90px;
        font-size: 20px;
      }
      
      .reel {
        height: 270px;
      }
      
      .spin-button {
        width: 140px;
        height: 140px;
        font-size: 20px;
      }
    }

    @media (max-width: 768px) {
      body { padding: 10px; }
      
      .slot-machine {
        max-width: 100%;
        padding: 25px;
        border-width: 6px;
        transform: none;
      }
      
      .reels-container {
        gap: 20px;
        padding: 25px;
      }
      
      .reel {
        height: 200px;
      }
      
      .team-symbol {
        width: 70px;
        height: 70px;
        font-size: 16px;
      }
      
      .controls-section {
        grid-template-columns: 1fr;
        gap: 25px;
        text-align: center;
      }
      
      .spin-button {
        width: 120px;
        height: 120px;
        font-size: 18px;
        justify-self: center;
      }
      
      .betting-controls {
        justify-self: center;
      }
      
      .info-displays {
        grid-template-columns: 1fr;
        gap: 15px;
      }
    }

    /* 4K Ultra Enhancement */
    @media (min-width: 2560px) {
      .slot-machine {
        max-width: 1600px;
        padding: 80px;
      }
      
      .machine-title {
        font-size: 80px;
      }
      
      .jackpot-display {
        font-size: 48px;
        padding: 30px 60px;
      }
      
      .reel {
        height: 480px;
      }
      
      .team-symbol {
        width: 160px;
        height: 160px;
        font-size: 36px;
      }
      
      .spin-button {
        width: 200px;
        height: 200px;
        font-size: 32px;
      }
      
      .info-value {
        font-size: 48px;
      }
      
      .led-light {
        width: 40px;
        height: 40px;
      }
    }

    /* Machine vibration effect */
    .slot-machine.vibrate {
      animation: machineVibrateUltra 0.1s linear infinite;
    }

    @keyframes machineVibrateUltra {
      0% { transform: perspective(1000px) rotateX(2deg) translateX(0); }
      25% { transform: perspective(1000px) rotateX(2deg) translateX(-3px); }
      50% { transform: perspective(1000px) rotateX(2deg) translateX(3px); }
      75% { transform: perspective(1000px) rotateX(2deg) translateX(-2px); }
      100% { transform: perspective(1000px) rotateX(2deg) translateX(2px); }
    }

    /* Special Effects */
    .jackpot-celebration {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 1999;
      background: radial-gradient(circle at center, 
        rgba(255, 182, 18, 0.4) 0%, 
        rgba(255, 182, 18, 0.2) 30%,
        transparent 70%);
      animation: jackpotCelebrationUltra 4s ease-out;
    }

    @keyframes jackpotCelebrationUltra {
      0% { 
        opacity: 0; 
        transform: scale(0.5) rotate(-180deg);
        filter: brightness(2) hue-rotate(0deg);
      }
      25% {
        opacity: 1;
        transform: scale(1.2) rotate(0deg);
        filter: brightness(1.5) hue-rotate(90deg);
      }
      75% {
        opacity: 1;
        transform: scale(1.1) rotate(180deg);
        filter: brightness(1.2) hue-rotate(180deg);
      }
      100% { 
        opacity: 0; 
        transform: scale(1) rotate(360deg);
        filter: brightness(1) hue-rotate(360deg);
      }
    }

    .confetti {
      position: fixed;
      width: 12px;
      height: 12px;
      background: var(--nfl-gold);
      border-radius: 50%;
      box-shadow: 0 0 10px rgba(255, 182, 18, 0.8);
      animation: confettiDropUltra 4s linear infinite;
      will-change: transform, opacity;
    }

    @keyframes confettiDropUltra {
      0% { 
        transform: translateY(-100vh) rotate(0deg) scale(1) translateZ(0);
        opacity: 1;
      }
      50% {
        opacity: 1;
        transform: translateY(50vh) rotate(720deg) scale(1.2) translateZ(0);
      }
      100% { 
        transform: translateY(100vh) rotate(1440deg) scale(0.8) translateZ(0);
        opacity: 0;
      }
    }
  </style>
</head>
<body>
  <div class="game-container">
    <div class="slot-machine">
      <!-- LED Lights -->
      <div class="led-lights">
        <div class="led-light"></div>
        <div class="led-light"></div>
        <div class="led-light"></div>
        <div class="led-light"></div>
        <div class="led-light"></div>
        <div class="led-light"></div>
        <div class="led-light"></div>
        <div class="led-light"></div>
        <div class="led-light"></div>
        <div class="led-light"></div>
        <div class="led-light"></div>
        <div class="led-light"></div>
        <div class="led-light"></div>
        <div class="led-light"></div>
        <div class="led-light"></div>
        <div class="led-light"></div>
      </div>

      <!-- Machine Header -->
      <div class="machine-header">
        <div class="nfl-logo">NFL</div>
        <h1 class="machine-title">NFL CHAMPIONSHIP SLOTS</h1>
        <div class="jackpot-display" id="jackpot">
          🏆 JACKPOT: <span id="jackpot-amount">50,000</span> 🏆
        </div>
      </div>

      <!-- Reels Container -->
      <div class="reels-container">
        <div class="payline line-1" data-line="0"></div>
        <div class="payline line-2" data-line="1"></div>
        <div class="payline line-3" data-line="2"></div>
        
        <div class="reel" id="reel1">
          <div class="symbol-track">
            <div class="team-symbol team-nfl" data-symbol="NFL Shield">🏈</div>
            <div class="team-symbol team-chiefs" data-symbol="Chiefs">KC</div>
            <div class="team-symbol team-patriots" data-symbol="Patriots">NE</div>
          </div>
        </div>
        
        <div class="reel" id="reel2">
          <div class="symbol-track">
            <div class="team-symbol team-packers" data-symbol="Packers">GB</div>
            <div class="team-symbol team-cowboys" data-symbol="Cowboys">DAL</div>
            <div class="team-symbol team-steelers" data-symbol="Steelers">PIT</div>
          </div>
        </div>
        
        <div class="reel" id="reel3">
          <div class="symbol-track">
            <div class="team-symbol team-49ers" data-symbol="49ers">SF</div>
            <div class="team-symbol team-eagles" data-symbol="Eagles">PHI</div>
            <div class="team-symbol team-falcons" data-symbol="Falcons">ATL</div>
          </div>
        </div>
      </div>

      <!-- Controls Section -->
      <div class="controls-section">
        <!-- Info Displays -->
        <div class="info-displays">
          <div class="info-card">
            <div class="info-label">CREDITS</div>
            <div class="info-value" id="credits">1,000</div>
          </div>
          <div class="info-card">
            <div class="info-label">BET</div>
            <div class="info-value" id="bet-amount">25</div>
          </div>
          <div class="info-card">
            <div class="info-label">WIN</div>
            <div class="info-value" id="win-amount">0</div>
          </div>
        </div>

        <!-- Spin Button -->
        <button class="spin-button" id="spin-button">
          SPIN
        </button>

        <!-- Betting Controls -->
        <div class="betting-controls">
          <button class="bet-button bet-down">BET -</button>
          <button class="bet-button bet-up">BET +</button>
          <button class="bet-button max-bet">MAX BET</button>
          <button class="bet-button autoplay-button">AUTO</button>
        </div>
      </div>

      <!-- Game Controls -->
      <div class="game-controls">
        <button class="control-button paytable-button">PAYTABLE</button>
        <button class="control-button" onclick="toggleSound()">SOUND</button>
        <button class="control-button" onclick="toggleFullscreen()">FULLSCREEN</button>
      </div>
    </div>
  </div>

  <!-- Win Overlay -->
  <div class="win-overlay" id="winOverlay">
    <div class="win-text">🏆 BIG WIN! 🏆</div>
    <div class="win-amount">1,250 CREDITS!</div>
  </div>

  <!-- Paytable Overlay -->
  <div class="paytable-overlay"></div>
  
  <!-- Paytable Modal -->
  <div class="paytable">
    <button class="paytable-close">&times;</button>
    <h2 class="paytable-title">NFL CHAMPIONSHIP PAYOUTS</h2>
    
    <div class="paytable-section">
      <h3>🏆 JACKPOT SYMBOLS</h3>
      <div class="payout-item">
        <div class="payout-symbols">
          <span>🏆 SUPER BOWL TROPHY 🏆</span>
        </div>
        <div class="payout-value">JACKPOT!</div>
      </div>
    </div>

    <div class="paytable-section">
      <h3>🏈 PREMIUM SYMBOLS</h3>
      <div class="payout-item">
        <div class="payout-symbols">
          <span>AFC Championship</span>
        </div>
        <div class="payout-value">1000x</div>
      </div>
      <div class="payout-item">
        <div class="payout-symbols">
          <span>NFC Championship</span>
        </div>
        <div class="payout-value">1000x</div>
      </div>
      <div class="payout-item">
        <div class="payout-symbols">
          <span>🏈 NFL Shield (WILD)</span>
        </div>
        <div class="payout-value">500x</div>
      </div>
    </div>

    <div class="paytable-section">
      <h3>🏟️ TEAM SYMBOLS</h3>
      <div class="payout-item">
        <div class="payout-symbols">
          <span>Patriots (NE)</span>
        </div>
        <div class="payout-value">150x</div>
      </div>
      <div class="payout-item">
        <div class="payout-symbols">
          <span>Chiefs (KC)</span>
        </div>
        <div class="payout-value">140x</div>
      </div>
      <div class="payout-item">
        <div class="payout-symbols">
          <span>Eagles (PHI)</span>
        </div>
        <div class="payout-value">130x</div>
      </div>
      <div class="payout-item">
        <div class="payout-symbols">
          <span>Packers (GB) / Cowboys (DAL) / Steelers (PIT)</span>
        </div>
        <div class="payout-value">125x</div>
      </div>
      <div class="payout-item">
        <div class="payout-symbols">
          <span>49ers (SF)</span>
        </div>
        <div class="payout-value">110x</div>
      </div>
      <div class="payout-item">
        <div class="payout-symbols">
          <span>Falcons (ATL) & Other Teams</span>
        </div>
        <div class="payout-value">100x</div>
      </div>
    </div>

    <div class="paytable-section">
      <h3>ℹ️ GAME INFO</h3>
      <p style="margin-bottom: 15px; font-size: 16px;"><strong>Wild Symbol:</strong> NFL Shield substitutes for all symbols except Trophy</p>
      <p style="margin-bottom: 15px; font-size: 16px;"><strong>Jackpot:</strong> 3 Trophy symbols anywhere on reels</p>
      <p style="margin-bottom: 15px; font-size: 16px;"><strong>Paylines:</strong> 3 horizontal lines pay left to right</p>
      <p style="margin-bottom: 15px; font-size: 16px;"><strong>Minimum Bet:</strong> 5 credits</p>
      <p style="font-size: 16px;"><strong>Maximum Bet:</strong> 100 credits</p>
    </div>
  </div>

  <script>
    // ROBUST NFL Slots Game - Error-Free Implementation
    (function() {
      'use strict';

      try {
        class NFLSlots4K {
          constructor() {
            // Game state
            this.credits = 1000;
            this.bet = 25;
            this.maxBet = 100;
            this.minBet = 5;
            this.isSpinning = false;
            this.autoplay = false;
            this.autoplaySpins = 0;
            this.maxAutoplaySpins = 10;
            this.jackpot = 50000;

            // Performance variables
            this.spinDuration = 3000;
            this.reelStopDelay = 400;
            this.soundEnabled = true;

            // Initialize game elements safely
            this.elements = this.safeInitializeElements();
            
            // Initialize teams data
            this.teams = this.initializeTeams();

            // Initialize game
            this.init();
          }

          safeInitializeElements() {
            const getElementById = (id) => {
              try {
                return document.getElementById(id) || null;
              } catch (e) {
                console.warn(`Element ${id} not found`);
                return null;
              }
            };

            const querySelector = (selector) => {
              try {
                return document.querySelector(selector) || null;
              } catch (e) {
                console.warn(`Element ${selector} not found`);
                return null;
              }
            };

            const querySelectorAll = (selector) => {
              try {
                return document.querySelectorAll(selector) || [];
              } catch (e) {
                console.warn(`Elements ${selector} not found`);
                return [];
              }
            };

            return {
              reels: [
                getElementById('reel1'),
                getElementById('reel2'),
                getElementById('reel3')
              ].filter(Boolean),
              spinButton: querySelector('.spin-button'),
              creditsDisplay: getElementById('credits'),
              betDisplay: getElementById('bet-amount'),
              winDisplay: getElementById('win-amount'),
              jackpotDisplay: getElementById('jackpot-amount'),
              winOverlay: getElementById('winOverlay'),
              betUpButton: querySelector('.bet-up'),
              betDownButton: querySelector('.bet-down'),
              maxBetButton: querySelector('.max-bet'),
              autoplayButton: querySelector('.autoplay-button'),
              ledLights: querySelectorAll('.led-light'),
              paylines: querySelectorAll('.payline'),
              paytable: querySelector('.paytable'),
              paytableButton: querySelector('.paytable-button'),
              paytableClose: querySelector('.paytable-close'),
              paytableOverlay: querySelector('.paytable-overlay')
            };
          }

          initializeTeams() {
            return [
              { name: 'NFL Shield', class: 'team-nfl', text: '🏈', value: 15, isWild: true, isPremium: true },
              { name: 'Trophy', class: 'team-trophy', text: '🏆', value: 2000, isJackpot: true },
              { name: 'AFC', class: 'team-afc', text: 'AFC', value: 1000, isPremium: true },
              { name: 'NFC', class: 'team-nfc', text: 'NFC', value: 1000, isPremium: true },
              { name: 'Chiefs', class: 'team-chiefs', text: 'KC', value: 140 },
              { name: 'Patriots', class: 'team-patriots', text: 'NE', value: 150 },
              { name: 'Packers', class: 'team-packers', text: 'GB', value: 125 },
              { name: 'Cowboys', class: 'team-cowboys', text: 'DAL', value: 125 },
              { name: 'Steelers', class: 'team-steelers', text: 'PIT', value: 125 },
              { name: '49ers', class: 'team-49ers', text: 'SF', value: 110 },
              { name: 'Eagles', class: 'team-eagles', text: 'PHI', value: 130 },
              { name: 'Falcons', class: 'team-falcons', text: 'ATL', value: 100 }
            ];
          }

          init() {
            try {
              this.initEventListeners();
              this.initReels();
              this.updateDisplays();
              this.startIdleLights();
              
              // Demo spin after 3 seconds
              setTimeout(() => {
                if (!this.isSpinning) {
                  this.spin();
                }
              }, 3000);
            } catch (e) {
              console.error('Init error:', e);
            }
          }

          initEventListeners() {
            try {
              // Spin button
              if (this.elements.spinButton) {
                this.elements.spinButton.addEventListener('click', () => this.spin());
              }

              // Betting controls
              if (this.elements.betUpButton) {
                this.elements.betUpButton.addEventListener('click', () => this.adjustBet(5));
              }
              if (this.elements.betDownButton) {
                this.elements.betDownButton.addEventListener('click', () => this.adjustBet(-5));
              }
              if (this.elements.maxBetButton) {
                this.elements.maxBetButton.addEventListener('click', () => this.setMaxBet());
              }
              if (this.elements.autoplayButton) {
                this.elements.autoplayButton.addEventListener('click', () => this.toggleAutoplay());
              }

              // Paytable
              if (this.elements.paytableButton) {
                this.elements.paytableButton.addEventListener('click', () => this.showPaytable());
              }
              if (this.elements.paytableClose) {
                this.elements.paytableClose.addEventListener('click', () => this.hidePaytable());
              }
              if (this.elements.paytableOverlay) {
                this.elements.paytableOverlay.addEventListener('click', () => this.hidePaytable());
              }

              // Keyboard controls
              document.addEventListener('keydown', (e) => this.handleKeydown(e));

              // Prevent paytable close on internal clicks
              if (this.elements.paytable) {
                this.elements.paytable.addEventListener('click', (e) => e.stopPropagation());
              }
            } catch (e) {
              console.error('Event listener error:', e);
            }
          }

          handleKeydown(e) {
            try {
              switch(e.code) {
                case 'Space':
                  e.preventDefault();
                  this.spin();
                  break;
                case 'ArrowUp':
                  e.preventDefault();
                  this.adjustBet(5);
                  break;
                case 'ArrowDown':
                  e.preventDefault();
                  this.adjustBet(-5);
                  break;
                case 'KeyM':
                  this.setMaxBet();
                  break;
                case 'KeyA':
                  this.toggleAutoplay();
                  break;
                case 'KeyP':
                  this.showPaytable();
                  break;
              }
            } catch (e) {
              console.error('Keydown error:', e);
            }
          }

          initReels() {
            try {
              this.elements.reels.forEach((reel, index) => {
                if (reel) {
                  const track = reel.querySelector('.symbol-track');
                  if (track) {
                    this.setReelSymbols(index, this.getRandomReelSymbols());
                  }
                }
              });
            } catch (e) {
              console.error('Reel init error:', e);
            }
          }

          getRandomSymbol() {
            try {
              return this.teams[Math.floor(Math.random() * this.teams.length)];
            } catch (e) {
              console.error('Random symbol error:', e);
              return this.teams[0];
            }
          }

          getRandomReelSymbols() {
            try {
              return [this.getRandomSymbol(), this.getRandomSymbol(), this.getRandomSymbol()];
            } catch (e) {
              console.error('Random reel symbols error:', e);
              return [this.teams[0], this.teams[1], this.teams[2]];
            }
          }

          setReelSymbols(reelIndex, symbols) {
            try {
              const reel = this.elements.reels[reelIndex];
              if (!reel) return;

              const track = reel.querySelector('.symbol-track');
              if (!track) return;

              track.innerHTML = '';
              symbols.forEach(symbol => {
                const div = document.createElement('div');
                div.className = `team-symbol ${symbol.class}`;
                div.setAttribute('data-symbol', symbol.name);
                div.textContent = symbol.text;
                track.appendChild(div);
              });
            } catch (e) {
              console.error('Set reel symbols error:', e);
            }
          }

          adjustBet(amount) {
            try {
              if (this.isSpinning) return;

              const newBet = Math.max(this.minBet, Math.min(this.maxBet, this.bet + amount));
              if (newBet !== this.bet) {
                this.bet = newBet;
                this.updateDisplays();
                
                // Visual feedback
                const betCard = this.elements.betDisplay?.closest('.info-card');
                if (betCard) {
                  betCard.style.transform = 'scale(1.05)';
                  setTimeout(() => {
                    betCard.style.transform = 'scale(1)';
                  }, 150);
                }
              }
            } catch (e) {
              console.error('Adjust bet error:', e);
            }
          }

          setMaxBet() {
            try {
              if (this.isSpinning) return;
              this.bet = this.maxBet;
              this.updateDisplays();
            } catch (e) {
              console.error('Set max bet error:', e);
            }
          }

          toggleAutoplay() {
            try {
              this.autoplay = !this.autoplay;

              if (this.autoplay) {
                this.autoplaySpins = this.maxAutoplaySpins;
                this.elements.autoplayButton?.classList.add('active');
                if (this.elements.autoplayButton) {
                  this.elements.autoplayButton.textContent = `AUTO (${this.autoplaySpins})`;
                }
                this.autoSpin();
              } else {
                this.autoplaySpins = 0;
                this.elements.autoplayButton?.classList.remove('active');
                if (this.elements.autoplayButton) {
                  this.elements.autoplayButton.textContent = 'AUTO';
                }
              }
            } catch (e) {
              console.error('Toggle autoplay error:', e);
            }
          }

          async autoSpin() {
            try {
              if (!this.autoplay || this.autoplaySpins <= 0) {
                this.autoplay = false;
                this.elements.autoplayButton?.classList.remove('active');
                if (this.elements.autoplayButton) {
                  this.elements.autoplayButton.textContent = 'AUTO';
                }
                return;
              }

              await this.spin(true);

              if (this.autoplay && this.autoplaySpins > 0) {
                setTimeout(() => this.autoSpin(), 1500);
              }
            } catch (e) {
              console.error('Auto spin error:', e);
            }
          }

          updateDisplays() {
            try {
              if (this.elements.creditsDisplay) {
                this.elements.creditsDisplay.textContent = this.credits.toLocaleString();
              }
              if (this.elements.betDisplay) {
                this.elements.betDisplay.textContent = this.bet.toString();
              }
              if (this.elements.jackpotDisplay) {
                this.elements.jackpotDisplay.textContent = this.jackpot.toLocaleString();
              }
            } catch (e) {
              console.error('Update displays error:', e);
            }
          }

          calculateWin(grid) {
            try {
              const lines = [
                [[0,0],[1,0],[2,0]], // Top row
                [[0,1],[1,1],[2,1]], // Middle row
                [[0,2],[1,2],[2,2]], // Bottom row
              ];

              let totalWin = 0;
              let winningLines = [];
              let winType = 'no-win';

              for (let lineIndex = 0; lineIndex < lines.length; lineIndex++) {
                const line = lines[lineIndex];
                const symbols = line.map(([c,r]) => grid[c][r]);

                // Handle wild cards
                const wilds = symbols.filter(s => s.isWild).length;
                const nonWilds = symbols.filter(s => !s.isWild);

                if (nonWilds.length === 0) continue;

                const baseSymbol = nonWilds[0];
                const matchingSymbols = nonWilds.filter(s => s.name === baseSymbol.name).length + wilds;

                if (matchingSymbols === 3) {
                  let lineWin = 0;

                  if (baseSymbol.isJackpot) {
                    lineWin = this.jackpot;
                    winType = 'jackpot';
                  } else if (baseSymbol.isPremium) {
                    lineWin = Math.floor(baseSymbol.value * this.bet / 5);
                    winType = 'premium';
                  } else {
                    lineWin = Math.floor(baseSymbol.value * this.bet / 5);
                    winType = 'three-match';
                  }

                  totalWin += lineWin;
                  winningLines.push({ line: lineIndex, symbols, win: lineWin });
                } else if (matchingSymbols === 2) {
                  const lineWin = Math.floor(baseSymbol.value * this.bet / 20);
                  totalWin += lineWin;
                  winningLines.push({ line: lineIndex, symbols, win: lineWin });
                  if (winType === 'no-win') winType = 'two-match';
                }
              }

              return { 
                win: totalWin, 
                type: winType, 
                lines: winningLines,
                multiplier: this.bet / 5
              };
            } catch (e) {
              console.error('Calculate win error:', e);
              return { win: 0, type: 'no-win', lines: [], multiplier: 1 };
            }
          }

          async spin(isAutoplay = false) {
            try {
              if (this.isSpinning) return;
              if (this.credits < this.bet) {
                this.showMessage('Not enough credits!');
                this.autoplay = false;
                return;
              }

              // Deduct bet
              this.credits -= this.bet;
              if (this.autoplay) {
                this.autoplaySpins--;
                if (this.elements.autoplayButton) {
                  this.elements.autoplayButton.textContent = `AUTO (${this.autoplaySpins})`;
                }
              }

              this.isSpinning = true;
              if (this.elements.spinButton) {
                this.elements.spinButton.disabled = true;
              }
              this.updateDisplays();

              // Clear previous win state
              this.hideWinOverlay();
              this.clearSymbolHighlights();
              this.hidePaylines();

              // Add machine vibration effect
              const machine = document.querySelector('.slot-machine');
              machine?.classList.add('vibrate');

              // Start spinning effects
              this.startSpinEffects();

              // Generate final result
              const finalGrid = [
                this.getRandomReelSymbols(),
                this.getRandomReelSymbols(), 
                this.getRandomReelSymbols()
              ];

              // Smooth reel spinning
              const spinPromises = this.elements.reels.map(async (reel, index) => {
                const track = reel.querySelector('.symbol-track');
                if (!track) return;

                // Pre-populate with many symbols for smooth spinning
                this.createSpinningSymbols(track);
                
                // Start spinning animation
                track.classList.add('spinning');

                // Wait for reel-specific delay
                await this.delay(this.spinDuration + (index * this.reelStopDelay));

                // Stop spinning
                track.classList.remove('spinning');
                track.classList.add('decelerating');
                
                // Set final symbols
                setTimeout(() => {
                  this.setReelSymbols(index, finalGrid[index]);
                }, 200);

                // Remove deceleration class
                setTimeout(() => {
                  track.classList.remove('decelerating');
                }, 2000);
              });

              // Wait for all reels to stop
              await Promise.all(spinPromises);

              // Remove vibration
              machine?.classList.remove('vibrate');

              // Stop spinning effects
              this.stopSpinEffects();

              // Calculate and handle win
              const result = this.calculateWin(finalGrid);
              await this.handleWinResult(result, finalGrid);

              // Re-enable controls
              this.isSpinning = false;
              if (this.elements.spinButton) {
                this.elements.spinButton.disabled = false;
              }
            } catch (e) {
              console.error('Spin error:', e);
              this.isSpinning = false;
              if (this.elements.spinButton) {
                this.elements.spinButton.disabled = false;
              }
            }
          }

          createSpinningSymbols(track) {
            try {
              // Create 20 random symbols for ultra-smooth spinning
              const spinSymbols = [];
              for (let i = 0; i < 20; i++) {
                spinSymbols.push(this.getRandomSymbol());
              }

              track.innerHTML = '';
              spinSymbols.forEach(symbol => {
                const div = document.createElement('div');
                div.className = `team-symbol ${symbol.class}`;
                div.setAttribute('data-symbol', symbol.name);
                div.textContent = symbol.text;
                track.appendChild(div);
              });
            } catch (e) {
              console.error('Create spinning symbols error:', e);
            }
          }

          async handleWinResult(result, grid) {
            try {
              if (result.win > 0) {
                this.credits += result.win;

                // Show win animations
                await this.showWinEffects(result, grid);

                // Update win display
                if (this.elements.winDisplay) {
                  this.elements.winDisplay.textContent = result.win.toLocaleString();
                }

                // Show coin animation
                this.animateCoins(result.win);

                // Special effects for big wins
                if (result.type === 'jackpot') {
                  this.createJackpotCelebration();
                } else if (result.win > this.bet * 10) {
                  this.createBigWinEffects();
                }
              }

              this.updateDisplays();
            } catch (e) {
              console.error('Handle win result error:', e);
            }
          }

          async showWinEffects(result, grid) {
            try {
              // Highlight winning paylines
              result.lines.forEach(winLine => {
                if (winLine.line < this.elements.paylines.length) {
                  this.elements.paylines[winLine.line].classList.add('active');
                }
              });

              // Highlight winning symbols
              result.lines.forEach(winLine => {
                const linePositions = [
                  [[0,0],[1,0],[2,0]], // Top row
                  [[0,1],[1,1],[2,1]], // Middle row  
                  [[0,2],[1,2],[2,2]], // Bottom row
                ];

                if (winLine.line < linePositions.length) {
                  linePositions[winLine.line].forEach(([reelIndex, symbolIndex]) => {
                    const reel = this.elements.reels[reelIndex];
                    if (reel) {
                      const symbols = reel.querySelectorAll('.team-symbol');
                      if (symbols[symbolIndex]) {
                        symbols[symbolIndex].classList.add('win');
                      }
                    }
                  });
                }
              });

              // Show win overlay
              this.showWinOverlay(result);

              // Flash LED lights
              this.startWinLights();

              // Auto-hide after delay
              setTimeout(() => {
                this.hideWinOverlay();
                this.hidePaylines();
                this.clearSymbolHighlights();
                this.stopWinLights();
              }, 4000);
            } catch (e) {
              console.error('Show win effects error:', e);
            }
          }

          showWinOverlay(result) {
            try {
              if (!this.elements.winOverlay) return;

              let winText = '';
              let winAmount = '';
              
              switch(result.type) {
                case 'jackpot':
                  winText = '🏆 JACKPOT! 🏆';
                  winAmount = `${result.win.toLocaleString()} CREDITS!`;
                  break;
                case 'premium':
                  winText = '💎 BIG WIN! 💎';
                  winAmount = `${result.win.toLocaleString()} CREDITS!`;
                  break;
                case 'three-match':
                  winText = '🎉 THREE OF A KIND! 🎉';
                  winAmount = `${result.win.toLocaleString()} CREDITS!`;
                  break;
                default:
                  winText = '🎊 WIN! 🎊';
                  winAmount = `${result.win.toLocaleString()} CREDITS!`;
              }

              this.elements.winOverlay.innerHTML = `
                <div class="win-text">${winText}</div>
                <div class="win-amount">${winAmount}</div>
              `;
              this.elements.winOverlay.classList.add('visible');
            } catch (e) {
              console.error('Show win overlay error:', e);
            }
          }

          hideWinOverlay() {
            try {
              this.elements.winOverlay?.classList.remove('visible');
            } catch (e) {
              console.error('Hide win overlay error:', e);
            }
          }

          hidePaylines() {
            try {
              this.elements.paylines.forEach(payline => {
                payline.classList.remove('active');
              });
            } catch (e) {
              console.error('Hide paylines error:', e);
            }
          }

          clearSymbolHighlights() {
            try {
              this.elements.reels.forEach(reel => {
                const symbols = reel.querySelectorAll('.team-symbol');
                symbols.forEach(symbol => symbol.classList.remove('win'));
              });
            } catch (e) {
              console.error('Clear symbol highlights error:', e);
            }
          }

          animateCoins(amount) {
            try {
              const coinCount = Math.min(Math.floor(amount / 50), 30);
              const container = document.querySelector('.slot-machine');

              if (!container) return;

              for (let i = 0; i < coinCount; i++) {
                setTimeout(() => {
                  const coin = document.createElement('div');
                  coin.className = 'coin-animation';
                  coin.style.left = `${Math.random() * 70 + 15}%`;
                  coin.style.top = `60%`;
                  coin.textContent = '$';
                  container.appendChild(coin);

                  setTimeout(() => {
                    coin.remove();
                  }, 1500);
                }, i * 100);
              }
            } catch (e) {
              console.error('Animate coins error:', e);
            }
          }

          createJackpotCelebration() {
            try {
              // Create jackpot celebration overlay
              const celebration = document.createElement('div');
              celebration.className = 'jackpot-celebration';
              document.body.appendChild(celebration);
              
              this.createConfetti(100);
              
              setTimeout(() => {
                celebration.remove();
              }, 4000);
            } catch (e) {
              console.error('Jackpot celebration error:', e);
            }
          }

          createBigWinEffects() {
            try {
              this.createConfetti(50);
            } catch (e) {
              console.error('Big win effects error:', e);
            }
          }

          createConfetti(count = 50) {
            try {
              const colors = ['#FFB612', '#013369', '#D50A0A', '#A5ACAF', '#FFD700'];
              
              for (let i = 0; i < count; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 2 + 's';
                confetti.style.animationDuration = (Math.random() * 2 + 3) + 's';
                document.body.appendChild(confetti);
                
                setTimeout(() => {
                  confetti.remove();
                }, 6000);
              }
            } catch (e) {
              console.error('Confetti error:', e);
            }
          }

          startSpinEffects() {
            try {
              this.startSpinLights();
            } catch (e) {
              console.error('Start spin effects error:', e);
            }
          }

          stopSpinEffects() {
            try {
              this.stopSpinLights();
            } catch (e) {
              console.error('Stop spin effects error:', e);
            }
          }

          startIdleLights() {
            try {
              this.lightInterval = setInterval(() => {
                this.elements.ledLights.forEach(light => {
                  light.classList.toggle('on', Math.random() > 0.6);
                });
              }, 2500);
            } catch (e) {
              console.error('Start idle lights error:', e);
            }
          }

          startSpinLights() {
            try {
              this.stopIdleLights();

              let index = 0;
              this.spinLightInterval = setInterval(() => {
                this.elements.ledLights.forEach((light, i) => {
                  light.classList.remove('on', 'win');
                  if (i === index % this.elements.ledLights.length) {
                    light.classList.add('on');
                  }
                });
                index++;
              }, 80);
            } catch (e) {
              console.error('Start spin lights error:', e);
            }
          }

          stopSpinLights() {
            try {
              if (this.spinLightInterval) {
                clearInterval(this.spinLightInterval);
                this.spinLightInterval = null;
              }
              this.startIdleLights();
            } catch (e) {
              console.error('Stop spin lights error:', e);
            }
          }

          startWinLights() {
            try {
              this.stopIdleLights();

              this.winLightInterval = setInterval(() => {
                this.elements.ledLights.forEach(light => {
                  light.classList.remove('on');
                  light.classList.toggle('win', Math.random() > 0.2);
                });
              }, 120);
            } catch (e) {
              console.error('Start win lights error:', e);
            }
          }

          stopWinLights() {
            try {
              if (this.winLightInterval) {
                clearInterval(this.winLightInterval);
                this.winLightInterval = null;
              }

              this.elements.ledLights.forEach(light => {
                light.classList.remove('win');
              });

              this.startIdleLights();
            } catch (e) {
              console.error('Stop win lights error:', e);
            }
          }

          stopIdleLights() {
            try {
              if (this.lightInterval) {
                clearInterval(this.lightInterval);
                this.lightInterval = null;
              }
            } catch (e) {
              console.error('Stop idle lights error:', e);
            }
          }

          showPaytable() {
            try {
              this.elements.paytable?.classList.add('visible');
              this.elements.paytableOverlay?.classList.add('visible');
            } catch (e) {
              console.error('Show paytable error:', e);
            }
          }

          hidePaytable() {
            try {
              this.elements.paytable?.classList.remove('visible');
              this.elements.paytableOverlay?.classList.remove('visible');
            } catch (e) {
              console.error('Hide paytable error:', e);
            }
          }

          showMessage(message) {
            try {
              const messageDiv = document.createElement('div');
              messageDiv.className = 'win-overlay visible';
              messageDiv.innerHTML = `
                <div style="font-size: 32px; font-weight: 900; color: var(--nfl-red); margin-bottom: 20px;">⚠️ ${message} ⚠️</div>
              `;

              const container = document.querySelector('.slot-machine');
              if (container) {
                container.appendChild(messageDiv);

                setTimeout(() => {
                  messageDiv.remove();
                }, 2500);
              }
            } catch (e) {
              console.error('Show message error:', e);
            }
          }

          delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
          }
        }

        // Global functions
        let soundEnabled = true;
        let isFullscreen = false;

        window.toggleSound = function() {
          try {
            soundEnabled = !soundEnabled;
            const button = event.target;
            button.textContent = soundEnabled ? 'SOUND' : 'MUTED';
            button.style.opacity = soundEnabled ? '1' : '0.6';
            
            if (window.nflSlots4K) {
              window.nflSlots4K.soundEnabled = soundEnabled;
            }
          } catch (e) {
            console.error('Toggle sound error:', e);
          }
        };

        window.toggleFullscreen = function() {
          try {
            const gameContainer = document.querySelector('.game-container');
            
            if (!isFullscreen) {
              if (gameContainer.requestFullscreen) {
                gameContainer.requestFullscreen();
              } else if (gameContainer.webkitRequestFullscreen) {
                gameContainer.webkitRequestFullscreen();
              } else if (gameContainer.mozRequestFullScreen) {
                gameContainer.mozRequestFullScreen();
              }
            } else {
              if (document.exitFullscreen) {
                document.exitFullscreen();
              } else if (document.webkitExitFullscreen) {
                document.webkitExitFullscreen();
              } else if (document.mozCancelFullScreen) {
                document.mozCancelFullScreen();
              }
            }
          } catch (e) {
            console.error('Toggle fullscreen error:', e);
          }
        };

        // Fullscreen change handlers
        ['fullscreenchange', 'webkitfullscreenchange', 'mozfullscreenchange'].forEach(event => {
          document.addEventListener(event, () => {
            try {
              isFullscreen = !!(document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement);
              const button = document.querySelector('.control-button:last-child');
              if (button) {
                button.textContent = isFullscreen ? 'EXIT FULLSCREEN' : 'FULLSCREEN';
              }
            } catch (e) {
              console.error('Fullscreen change error:', e);
            }
          });
        });

        // Mobile viewport optimization
        function setViewportHeight() {
          try {
            const vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);
          } catch (e) {
            console.error('Viewport height error:', e);
          }
        }

        setViewportHeight();
        window.addEventListener('resize', setViewportHeight);
        window.addEventListener('orientationchange', () => {
          setTimeout(setViewportHeight, 100);
        });

        // Initialize the game
        document.addEventListener('DOMContentLoaded', () => {
          try {
            if (document.querySelector('.slot-machine')) {
              window.nflSlots4K = new NFLSlots4K();
              console.log('NFL Slots 4K initialized successfully');
            }
          } catch (e) {
            console.error('Game initialization error:', e);
          }
        });

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
          try {
            if (window.nflSlots4K) {
              // Clean up intervals
              window.nflSlots4K.stopIdleLights();
              window.nflSlots4K.stopSpinLights();
              window.nflSlots4K.stopWinLights();
            }
          } catch (e) {
            console.error('Cleanup error:', e);
          }
        });

      } catch (e) {
        console.error('Main script error:', e);
      }
    })();
  </script>
</body>
</html>
