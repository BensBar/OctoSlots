<!DOCTYPE html>
<html>
<head>
    <title>Fallback Test</title>
    <style>
        .symbol { width: 128px; height: 128px; border: 1px solid #ccc; margin: 10px; display: inline-block; }
        .symbol img { width: 100%; height: 100%; object-fit: contain; }
    </style>
</head>
<body>
    <h1>Testing NEW Fallback Logic</h1>
    
    <div class="symbol" id="test1">
        <h3>Test 1: Valid image</h3>
    </div>
    
    <div class="symbol" id="test2">
        <h3>Test 2: Broken image</h3>
    </div>

    <div class="symbol" id="test3">
        <h3>Test 3: Super slow image (timeout)</h3>
    </div>
    
    <script>
        function createTestSymbol(containerId, imageSrc, isSlowTest = false) {
            const container = document.getElementById(containerId);
            
            // NEW FALLBACK LOGIC (copied from index.html)
            const img = document.createElement('img');
            img.style.width = '100%';
            img.style.height = '100%';
            img.style.objectFit = 'contain';
            img.decoding = 'async';
            img.loading = 'eager';
            img.alt = 'Symbol';

            let triedOriginal = false;
            let finished = false;

            // Safety timeout: if slow to load, swap to original.png
            const safetyTimeout = setTimeout(() => {
              if (!finished && !triedOriginal && imageSrc !== 'images/original.png') {
                console.warn('Symbol load slow, swapping to original.png:', imageSrc);
                triedOriginal = true;
                img.src = 'images/original.png';
              }
            }, isSlowTest ? 1000 : 2500); // Faster timeout for slow test

            img.onload = () => {
              finished = true;
              clearTimeout(safetyTimeout);
              img.style.background = 'transparent';
              console.log('Image loaded successfully:', img.src);
            };

            img.onerror = () => {
              if (!triedOriginal && img.src.indexOf('images/original.png') === -1) {
                triedOriginal = true;
                console.warn('Image failed to load, trying original.png:', imageSrc);
                img.src = 'images/original.png';
                return; // wait for onload/onerror again
              }
              finished = true;
              clearTimeout(safetyTimeout);
              img.style.opacity = '0.15';
              img.style.background = '#ffffff'; // subtle placeholder
              console.warn('Even original.png failed, using placeholder style');
            };

            img.src = imageSrc;
            container.appendChild(img);
        }
        
        // Run tests
        createTestSymbol('test1', 'images/original.png');
        createTestSymbol('test2', 'images/nonexistent-image.png'); 
        createTestSymbol('test3', 'images/original.png?delay=5000', true); // simulated slow
    </script>
</body>
</html>